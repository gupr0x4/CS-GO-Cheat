; Listing generated by Microsoft (R) Optimizing Compiler Version 19.16.27034.0 

include listing.inc

INCLUDELIB OLDNAMES

PUBLIC	?server_thread@@YAXPEAX@Z			; server_thread
;	COMDAT pdata
pdata	SEGMENT
$pdata$?connection_thread@@YAXPEAX@Z DD imagerel ?connection_thread@@YAXPEAX@Z
	DD	imagerel ?connection_thread@@YAXPEAX@Z+105
	DD	imagerel $unwind$?connection_thread@@YAXPEAX@Z
pdata	ENDS
;	COMDAT pdata
pdata	SEGMENT
$pdata$1$?connection_thread@@YAXPEAX@Z DD imagerel ?connection_thread@@YAXPEAX@Z+105
	DD	imagerel ?connection_thread@@YAXPEAX@Z+511
	DD	imagerel $chain$1$?connection_thread@@YAXPEAX@Z
pdata	ENDS
;	COMDAT pdata
pdata	SEGMENT
$pdata$2$?connection_thread@@YAXPEAX@Z DD imagerel ?connection_thread@@YAXPEAX@Z+511
	DD	imagerel ?connection_thread@@YAXPEAX@Z+531
	DD	imagerel $chain$2$?connection_thread@@YAXPEAX@Z
pdata	ENDS
;	COMDAT pdata
pdata	SEGMENT
$pdata$?create_listen_socket@@YAHXZ DD imagerel ?create_listen_socket@@YAHXZ
	DD	imagerel ?create_listen_socket@@YAHXZ+62
	DD	imagerel $unwind$?create_listen_socket@@YAHXZ
pdata	ENDS
;	COMDAT pdata
pdata	SEGMENT
$pdata$2$?create_listen_socket@@YAHXZ DD imagerel ?create_listen_socket@@YAHXZ+62
	DD	imagerel ?create_listen_socket@@YAHXZ+194
	DD	imagerel $chain$2$?create_listen_socket@@YAHXZ
pdata	ENDS
;	COMDAT pdata
pdata	SEGMENT
$pdata$3$?create_listen_socket@@YAHXZ DD imagerel ?create_listen_socket@@YAHXZ+194
	DD	imagerel ?create_listen_socket@@YAHXZ+236
	DD	imagerel $chain$3$?create_listen_socket@@YAHXZ
pdata	ENDS
;	COMDAT pdata
pdata	SEGMENT
$pdata$4$?create_listen_socket@@YAHXZ DD imagerel ?create_listen_socket@@YAHXZ+236
	DD	imagerel ?create_listen_socket@@YAHXZ+258
	DD	imagerel $chain$4$?create_listen_socket@@YAHXZ
pdata	ENDS
;	COMDAT pdata
pdata	SEGMENT
$pdata$6$?create_listen_socket@@YAHXZ DD imagerel ?create_listen_socket@@YAHXZ+258
	DD	imagerel ?create_listen_socket@@YAHXZ+270
	DD	imagerel $chain$6$?create_listen_socket@@YAHXZ
pdata	ENDS
;	COMDAT pdata
pdata	SEGMENT
$pdata$7$?create_listen_socket@@YAHXZ DD imagerel ?create_listen_socket@@YAHXZ+270
	DD	imagerel ?create_listen_socket@@YAHXZ+280
	DD	imagerel $chain$7$?create_listen_socket@@YAHXZ
pdata	ENDS
;	COMDAT pdata
pdata	SEGMENT
$pdata$?server_thread@@YAXPEAX@Z DD imagerel $LN94
	DD	imagerel $LN94+85
	DD	imagerel $unwind$?server_thread@@YAXPEAX@Z
pdata	ENDS
;	COMDAT pdata
pdata	SEGMENT
$pdata$5$?server_thread@@YAXPEAX@Z DD imagerel $LN94+85
	DD	imagerel $LN94+409
	DD	imagerel $chain$5$?server_thread@@YAXPEAX@Z
pdata	ENDS
;	COMDAT pdata
pdata	SEGMENT
$pdata$6$?server_thread@@YAXPEAX@Z DD imagerel $LN94+409
	DD	imagerel $LN94+416
	DD	imagerel $chain$6$?server_thread@@YAXPEAX@Z
pdata	ENDS
;	COMDAT pdata
pdata	SEGMENT
$pdata$8$?server_thread@@YAXPEAX@Z DD imagerel $LN94+416
	DD	imagerel $LN94+817
	DD	imagerel $chain$8$?server_thread@@YAXPEAX@Z
pdata	ENDS
;	COMDAT xdata
xdata	SEGMENT
$chain$8$?server_thread@@YAXPEAX@Z DD 0e0522H
	DD	0bd405H
	DD	0af400H
	DD	0cc400H
	DD	0d7400H
	DD	0136400H
	DD	0125400H
	DD	0103400H
	DD	imagerel $LN94
	DD	imagerel $LN94+85
	DD	imagerel $unwind$?server_thread@@YAXPEAX@Z
xdata	ENDS
;	COMDAT xdata
xdata	SEGMENT
$chain$6$?server_thread@@YAXPEAX@Z DD 020022H
	DD	06001603H
	DD	imagerel $LN94
	DD	imagerel $LN94+85
	DD	imagerel $unwind$?server_thread@@YAXPEAX@Z
xdata	ENDS
;	COMDAT xdata
xdata	SEGMENT
$chain$5$?server_thread@@YAXPEAX@Z DD 0c3a22H
	DD	0af43aH
	DD	0cc435H
	DD	0d742bH
	DD	0136424H
	DD	0125414H
	DD	0103408H
	DD	imagerel $LN94
	DD	imagerel $LN94+85
	DD	imagerel $unwind$?server_thread@@YAXPEAX@Z
xdata	ENDS
;	COMDAT xdata
xdata	SEGMENT
$unwind$?server_thread@@YAXPEAX@Z DD 020602H
	DD	0e002d206H
xdata	ENDS
;	COMDAT xdata
xdata	SEGMENT
$chain$7$?create_listen_socket@@YAHXZ DD 020022H
	DD	06001601H
	DD	imagerel ?create_listen_socket@@YAHXZ
	DD	imagerel ?create_listen_socket@@YAHXZ+62
	DD	imagerel $unwind$?create_listen_socket@@YAHXZ
xdata	ENDS
;	COMDAT xdata
xdata	SEGMENT
$chain$6$?create_listen_socket@@YAHXZ DD 040022H
	DD	06001601H
	DD	0c6400H
	DD	imagerel ?create_listen_socket@@YAHXZ
	DD	imagerel ?create_listen_socket@@YAHXZ+62
	DD	imagerel $unwind$?create_listen_socket@@YAHXZ
xdata	ENDS
;	COMDAT xdata
xdata	SEGMENT
$chain$4$?create_listen_socket@@YAHXZ DD 040022H
	DD	06001601H
	DD	0c6400H
	DD	imagerel ?create_listen_socket@@YAHXZ
	DD	imagerel ?create_listen_socket@@YAHXZ+62
	DD	imagerel $unwind$?create_listen_socket@@YAHXZ
xdata	ENDS
;	COMDAT xdata
xdata	SEGMENT
$chain$3$?create_listen_socket@@YAHXZ DD 040022H
	DD	087400H
	DD	0c6400H
	DD	imagerel ?create_listen_socket@@YAHXZ
	DD	imagerel ?create_listen_socket@@YAHXZ+62
	DD	imagerel $unwind$?create_listen_socket@@YAHXZ
xdata	ENDS
;	COMDAT xdata
xdata	SEGMENT
$chain$2$?create_listen_socket@@YAHXZ DD 062522H
	DD	087425H
	DD	0c640cH
	DD	0b3405H
	DD	imagerel ?create_listen_socket@@YAHXZ
	DD	imagerel ?create_listen_socket@@YAHXZ+62
	DD	imagerel $unwind$?create_listen_socket@@YAHXZ
xdata	ENDS
;	COMDAT xdata
xdata	SEGMENT
$unwind$?create_listen_socket@@YAHXZ DD 010402H
	DD	08204H
xdata	ENDS
;	COMDAT xdata
xdata	SEGMENT
$chain$2$?connection_thread@@YAXPEAX@Z DD 020022H
	DD	06001606H
	DD	imagerel ?connection_thread@@YAXPEAX@Z
	DD	imagerel ?connection_thread@@YAXPEAX@Z+105
	DD	imagerel $unwind$?connection_thread@@YAXPEAX@Z
xdata	ENDS
;	COMDAT xdata
xdata	SEGMENT
$chain$1$?connection_thread@@YAXPEAX@Z DD 041322H
	DD	01d3413H
	DD	014e408H
	DD	imagerel ?connection_thread@@YAXPEAX@Z
	DD	imagerel ?connection_thread@@YAXPEAX@Z+105
	DD	imagerel $unwind$?connection_thread@@YAXPEAX@Z
xdata	ENDS
;	COMDAT xdata
xdata	SEGMENT
$unwind$?connection_thread@@YAXPEAX@Z DD 061202H
	DD	0150112H
	DD	07004f006H
	DD	050026003H
; Function compile flags: /Ogtp
; File c:\users\aapo\desktop\fortnite_shait\kernel rpm\dummy\server.cpp
; File c:\users\aapo\desktop\fortnite_shait\kernel rpm\dummy\ksocket\ksocket.c
; File c:\users\aapo\desktop\fortnite_shait\kernel rpm\dummy\server.cpp
; File c:\users\aapo\desktop\fortnite_shait\kernel rpm\dummy\ksocket\ksocket.c
; File c:\users\aapo\desktop\fortnite_shait\kernel rpm\dummy\server.cpp
; File c:\users\aapo\desktop\fortnite_shait\kernel rpm\dummy\ksocket\ksocket.c
; File c:\users\aapo\desktop\fortnite_shait\kernel rpm\dummy\server.cpp
; File c:\users\aapo\desktop\fortnite_shait\kernel rpm\dummy\ksocket\ksocket.c
; File c:\users\aapo\desktop\fortnite_shait\kernel rpm\dummy\ksocket\berkeley.c
; File c:\users\aapo\desktop\fortnite_shait\kernel rpm\dummy\ksocket\ksocket.c
; File c:\program files (x86)\windows kits\10\include\10.0.17763.0\km\wdm.h
; File c:\users\aapo\desktop\fortnite_shait\kernel rpm\dummy\ksocket\ksocket.c
; File c:\program files (x86)\windows kits\10\include\10.0.17763.0\km\wdm.h
; File c:\users\aapo\desktop\fortnite_shait\kernel rpm\dummy\ksocket\ksocket.c
; File c:\users\aapo\desktop\fortnite_shait\kernel rpm\dummy\ksocket\berkeley.c
; File c:\users\aapo\desktop\fortnite_shait\kernel rpm\dummy\server.cpp
; File c:\users\aapo\desktop\fortnite_shait\kernel rpm\dummy\ksocket\ksocket.c
; File c:\users\aapo\desktop\fortnite_shait\kernel rpm\dummy\server.cpp
; File c:\users\aapo\desktop\fortnite_shait\kernel rpm\dummy\ksocket\berkeley.c
; File c:\users\aapo\desktop\fortnite_shait\kernel rpm\dummy\server.cpp
; File c:\users\aapo\desktop\fortnite_shait\kernel rpm\dummy\ksocket\ksocket.c
; File c:\program files (x86)\windows kits\10\include\10.0.17763.0\km\wdm.h
; File c:\users\aapo\desktop\fortnite_shait\kernel rpm\dummy\ksocket\ksocket.c
; File c:\program files (x86)\windows kits\10\include\10.0.17763.0\km\wdm.h
; File c:\users\aapo\desktop\fortnite_shait\kernel rpm\dummy\ksocket\ksocket.c
; File c:\program files (x86)\windows kits\10\include\10.0.17763.0\km\wdm.h
; File c:\users\aapo\desktop\fortnite_shait\kernel rpm\dummy\ksocket\berkeley.c
; File c:\users\aapo\desktop\fortnite_shait\kernel rpm\dummy\server.cpp
; File c:\users\aapo\desktop\fortnite_shait\kernel rpm\dummy\ksocket\berkeley.c
; File c:\users\aapo\desktop\fortnite_shait\kernel rpm\dummy\server.cpp
; File c:\users\aapo\desktop\fortnite_shait\kernel rpm\dummy\ksocket\berkeley.c
; File c:\users\aapo\desktop\fortnite_shait\kernel rpm\dummy\server.cpp
; File c:\users\aapo\desktop\fortnite_shait\kernel rpm\dummy\ksocket\berkeley.c
; File c:\users\aapo\desktop\fortnite_shait\kernel rpm\dummy\server.cpp
;	COMDAT ?server_thread@@YAXPEAX@Z
_TEXT	SEGMENT
address$1 = 64
WskClient$2 = 64
socket_addr$3 = 64
__formal$ = 128
Socket$4 = 136
thread_handle$5 = 136
?server_thread@@YAXPEAX@Z PROC				; server_thread, COMDAT

; 71   : {

$LN94:
  00000	41 56		 push	 r14
  00002	48 83 ec 70	 sub	 rsp, 112		; 00000070H
; File c:\users\aapo\desktop\fortnite_shait\kernel rpm\dummy\ksocket\ksocket.c

; 247  :   WskClient.Dispatch      = &WskDispatch;

  00006	48 8d 05 00 00
	00 00		 lea	 rax, OFFSET FLAT:WskDispatch
  0000d	45 33 f6	 xor	 r14d, r14d

; 248  : 
; 249  :   Status = WskRegister(&WskClient, &WskRegistration);

  00010	48 8d 15 00 00
	00 00		 lea	 rdx, OFFSET FLAT:WskRegistration
  00017	4c 89 74 24 40	 mov	 QWORD PTR WskClient$2[rsp], r14
  0001c	48 8d 4c 24 40	 lea	 rcx, QWORD PTR WskClient$2[rsp]
  00021	48 89 44 24 48	 mov	 QWORD PTR WskClient$2[rsp+8], rax
  00026	ff 15 00 00 00
	00		 call	 QWORD PTR __imp_WskRegister

; 250  : 
; 251  :   if (!NT_SUCCESS(Status))

  0002c	85 c0		 test	 eax, eax
  0002e	0f 88 65 01 00
	00		 js	 $LN1@server_thr

; 252  :   {
; 253  :     return Status;
; 254  :   }
; 255  : 
; 256  :   //
; 257  :   // Capture the provider NPI.
; 258  :   //
; 259  : 
; 260  :   return WskCaptureProviderNPI(

  00034	4c 8d 05 00 00
	00 00		 lea	 r8, OFFSET FLAT:WskProvider
  0003b	ba ff ff ff ff	 mov	 edx, -1			; ffffffffH
  00040	48 8d 0d 00 00
	00 00		 lea	 rcx, OFFSET FLAT:WskRegistration
  00047	ff 15 00 00 00
	00		 call	 QWORD PTR __imp_WskCaptureProviderNPI
; File c:\users\aapo\desktop\fortnite_shait\kernel rpm\dummy\server.cpp

; 74   : 	if (!NT_SUCCESS(status))

  0004d	85 c0		 test	 eax, eax
  0004f	0f 88 44 01 00
	00		 js	 $LN1@server_thr

; 10   : 	SOCKADDR_IN address{ };

  00055	48 89 9c 24 80
	00 00 00	 mov	 QWORD PTR [rsp+128], rbx
; File c:\users\aapo\desktop\fortnite_shait\kernel rpm\dummy\ksocket\ksocket.c

; 439  :   return KsCreateSocket(Socket, AddressFamily, SocketType, Protocol, WSK_FLAG_LISTEN_SOCKET);

  0005d	45 8d 4e 06	 lea	 r9d, QWORD PTR [r14+6]
; File c:\users\aapo\desktop\fortnite_shait\kernel rpm\dummy\server.cpp

; 10   : 	SOCKADDR_IN address{ };

  00061	48 89 ac 24 90
	00 00 00	 mov	 QWORD PTR [rsp+144], rbp
; File c:\users\aapo\desktop\fortnite_shait\kernel rpm\dummy\ksocket\ksocket.c

; 439  :   return KsCreateSocket(Socket, AddressFamily, SocketType, Protocol, WSK_FLAG_LISTEN_SOCKET);

  00069	48 8d 8c 24 88
	00 00 00	 lea	 rcx, QWORD PTR Socket$4[rsp]
; File c:\users\aapo\desktop\fortnite_shait\kernel rpm\dummy\server.cpp

; 10   : 	SOCKADDR_IN address{ };

  00071	48 89 b4 24 98
	00 00 00	 mov	 QWORD PTR [rsp+152], rsi
  00079	33 c0		 xor	 eax, eax
  0007b	48 89 7c 24 68	 mov	 QWORD PTR [rsp+104], rdi
  00080	48 89 44 24 40	 mov	 QWORD PTR address$1[rsp], rax
  00085	4c 89 64 24 60	 mov	 QWORD PTR [rsp+96], r12
  0008a	4c 89 7c 24 50	 mov	 QWORD PTR [rsp+80], r15
  0008f	48 89 44 24 48	 mov	 QWORD PTR address$1[rsp+8], rax

; 11   : 
; 12   : 	address.sin_family	= AF_INET;

  00094	c7 44 24 40 02
	00 10 35	 mov	 DWORD PTR address$1[rsp], 890241026 ; 35100002H
; File c:\users\aapo\desktop\fortnite_shait\kernel rpm\dummy\ksocket\ksocket.c

; 439  :   return KsCreateSocket(Socket, AddressFamily, SocketType, Protocol, WSK_FLAG_LISTEN_SOCKET);

  0009c	e8 00 00 00 00	 call	 KsCreateSocket
; File c:\users\aapo\desktop\fortnite_shait\kernel rpm\dummy\ksocket\berkeley.c

; 513  :   if (NT_SUCCESS(Status))

  000a1	85 c0		 test	 eax, eax
  000a3	0f 88 af 00 00
	00		 js	 $LN83@server_thr

; 514  :   {
; 515  :     int sockfd = TO_SOCKETFD(KsIndex++);

  000a9	8b 0d 00 00 00
	00		 mov	 ecx, DWORD PTR KsIndex

; 516  : 
; 517  :     KsArray[FROM_SOCKETFD(sockfd)] = Socket;

  000af	4c 8d 25 00 00
	00 00		 lea	 r12, OFFSET FLAT:KsArray
  000b6	48 8b 84 24 88
	00 00 00	 mov	 rax, QWORD PTR Socket$4[rsp]
  000be	8b f1		 mov	 esi, ecx
  000c0	83 e6 7f	 and	 esi, 127		; 0000007fH
  000c3	ff c1		 inc	 ecx
  000c5	89 0d 00 00 00
	00		 mov	 DWORD PTR KsIndex, ecx
  000cb	49 89 04 f4	 mov	 QWORD PTR [r12+rsi*8], rax
  000cf	8d 6e 01	 lea	 ebp, DWORD PTR [rsi+1]

; 575  :   PKSOCKET Socket = KsArray[FROM_SOCKETFD(sockfd)];

  000d2	49 8b 1c f4	 mov	 rbx, QWORD PTR [r12+rsi*8]
  000d6	48 ff c6	 inc	 rsi
; File c:\users\aapo\desktop\fortnite_shait\kernel rpm\dummy\ksocket\ksocket.c

; 507  :   KspAsyncContextReset(&Socket->AsyncContext);

  000d9	48 8d 7b 10	 lea	 rdi, QWORD PTR [rbx+16]

; 173  :   KeResetEvent(&AsyncContext->CompletionEvent);

  000dd	48 8b cf	 mov	 rcx, rdi
  000e0	ff 15 00 00 00
	00		 call	 QWORD PTR __imp_KeResetEvent

; 174  : 
; 175  :   //
; 176  :   // Reuse the IRP.
; 177  :   //
; 178  : 
; 179  :   IoReuseIrp(AsyncContext->Irp, STATUS_UNSUCCESSFUL);

  000e6	48 8b 4f 18	 mov	 rcx, QWORD PTR [rdi+24]
  000ea	ba 01 00 00 c0	 mov	 edx, -1073741823	; ffffffffc0000001H
  000ef	ff 15 00 00 00
	00		 call	 QWORD PTR __imp_IoReuseIrp
; File c:\program files (x86)\windows kits\10\include\10.0.17763.0\km\wdm.h

; 31468:     return ((Irp)->Tail.Overlay.CurrentStackLocation - 1 );

  000f5	48 8b 47 18	 mov	 rax, QWORD PTR [rdi+24]

; 31851:     irpSp->CompletionRoutine = CompletionRoutine;

  000f9	4c 8d 3d 00 00
	00 00		 lea	 r15, OFFSET FLAT:KspAsyncContextCompletionRoutine
; File c:\users\aapo\desktop\fortnite_shait\kernel rpm\dummy\ksocket\ksocket.c

; 513  :   Status = Socket->WskListenDispatch->WskBind(

  00100	45 33 c0	 xor	 r8d, r8d
  00103	48 8d 54 24 40	 lea	 rdx, QWORD PTR address$1[rsp]
; File c:\program files (x86)\windows kits\10\include\10.0.17763.0\km\wdm.h

; 31468:     return ((Irp)->Tail.Overlay.CurrentStackLocation - 1 );

  00108	48 8b 88 b8 00
	00 00		 mov	 rcx, QWORD PTR [rax+184]

; 31851:     irpSp->CompletionRoutine = CompletionRoutine;

  0010f	4c 89 79 f0	 mov	 QWORD PTR [rcx-16], r15

; 31852:     irpSp->Context = Context;

  00113	48 89 79 f8	 mov	 QWORD PTR [rcx-8], rdi

; 31853:     irpSp->Control = 0;
; 31854: 
; 31855:     if (InvokeOnSuccess) {
; 31856:         irpSp->Control = SL_INVOKE_ON_SUCCESS;
; 31857:     }
; 31858: 
; 31859:     if (InvokeOnError) {
; 31860:         irpSp->Control |= SL_INVOKE_ON_ERROR;
; 31861:     }
; 31862: 
; 31863:     if (InvokeOnCancel) {
; 31864:         irpSp->Control |= SL_INVOKE_ON_CANCEL;

  00117	c6 41 bb e0	 mov	 BYTE PTR [rcx-69], 224	; 000000e0H
; File c:\users\aapo\desktop\fortnite_shait\kernel rpm\dummy\ksocket\ksocket.c

; 513  :   Status = Socket->WskListenDispatch->WskBind(

  0011b	48 8b 43 08	 mov	 rax, QWORD PTR [rbx+8]
  0011f	4c 8b 4b 28	 mov	 r9, QWORD PTR [rbx+40]
  00123	48 8b 0b	 mov	 rcx, QWORD PTR [rbx]
  00126	ff 50 10	 call	 QWORD PTR [rax+16]

; 213  :   if (*Status == STATUS_PENDING)

  00129	3d 03 01 00 00	 cmp	 eax, 259		; 00000103H
  0012e	75 1d		 jne	 SHORT $LN38@server_thr

; 214  :   {
; 215  :     KeWaitForSingleObject(

  00130	45 33 c9	 xor	 r9d, r9d
  00133	4c 89 74 24 20	 mov	 QWORD PTR [rsp+32], r14
  00138	45 33 c0	 xor	 r8d, r8d
  0013b	33 d2		 xor	 edx, edx
  0013d	48 8b cf	 mov	 rcx, rdi
  00140	ff 15 00 00 00
	00		 call	 QWORD PTR __imp_KeWaitForSingleObject

; 216  :       &AsyncContext->CompletionEvent,
; 217  :       Executive,
; 218  :       KernelMode,
; 219  :       FALSE,
; 220  :       NULL
; 221  :       );
; 222  : 
; 223  :     *Status = AsyncContext->Irp->IoStatus.Status;

  00146	48 8b 47 18	 mov	 rax, QWORD PTR [rdi+24]
  0014a	8b 40 30	 mov	 eax, DWORD PTR [rax+48]
$LN38@server_thr:
; File c:\users\aapo\desktop\fortnite_shait\kernel rpm\dummy\ksocket\berkeley.c

; 579  :   return NT_SUCCESS(Status)

  0014d	85 c0		 test	 eax, eax
; File c:\users\aapo\desktop\fortnite_shait\kernel rpm\dummy\server.cpp

; 22   : 	if (bind(listen_socket, (SOCKADDR*)&address, sizeof(address)) == SOCKET_ERROR)

  0014f	79 4f		 jns	 SHORT $LN78@server_thr

; 23   : 	{
; 24   : 		//log("Failed to bind socket.");
; 25   : 
; 26   : 		closesocket(listen_socket);

  00151	8b cd		 mov	 ecx, ebp
  00153	e8 00 00 00 00	 call	 closesocket
$LN83@server_thr:
; File c:\users\aapo\desktop\fortnite_shait\kernel rpm\dummy\ksocket\ksocket.c

; 277  :   WskReleaseProviderNPI(&WskRegistration);

  00158	48 8d 0d 00 00
	00 00		 lea	 rcx, OFFSET FLAT:WskRegistration
  0015f	ff 15 00 00 00
	00		 call	 QWORD PTR __imp_WskReleaseProviderNPI

; 278  : 
; 279  :   //
; 280  :   // Deregister as a WSK client.
; 281  :   //
; 282  : 
; 283  :   WskDeregister(&WskRegistration);

  00165	48 8d 0d 00 00
	00 00		 lea	 rcx, OFFSET FLAT:WskRegistration
  0016c	ff 15 00 00 00
	00		 call	 QWORD PTR __imp_WskDeregister
$LN91@server_thr:
  00172	4c 8b 64 24 60	 mov	 r12, QWORD PTR [rsp+96]
  00177	48 8b 7c 24 68	 mov	 rdi, QWORD PTR [rsp+104]
  0017c	48 8b b4 24 98
	00 00 00	 mov	 rsi, QWORD PTR [rsp+152]
  00184	48 8b ac 24 90
	00 00 00	 mov	 rbp, QWORD PTR [rsp+144]
  0018c	48 8b 9c 24 80
	00 00 00	 mov	 rbx, QWORD PTR [rsp+128]
  00194	4c 8b 7c 24 50	 mov	 r15, QWORD PTR [rsp+80]
$LN1@server_thr:
; File c:\users\aapo\desktop\fortnite_shait\kernel rpm\dummy\server.cpp

; 134  : }

  00199	48 83 c4 70	 add	 rsp, 112		; 00000070H
  0019d	41 5e		 pop	 r14
  0019f	c3		 ret	 0
$LN78@server_thr:
  001a0	4c 89 6c 24 58	 mov	 QWORD PTR [rsp+88], r13
  001a5	49 8d 34 f4	 lea	 rsi, QWORD PTR [r12+rsi*8]
  001a9	4c 8d 2d 00 00
	00 00		 lea	 r13, OFFSET FLAT:?connection_thread@@YAXPEAX@Z ; connection_thread
$LL2@server_thr:
; File c:\users\aapo\desktop\fortnite_shait\kernel rpm\dummy\ksocket\berkeley.c

; 587  :   PKSOCKET Socket = KsArray[FROM_SOCKETFD(sockfd)];

  001b0	48 8b 7e f8	 mov	 rdi, QWORD PTR [rsi-8]
; File c:\users\aapo\desktop\fortnite_shait\kernel rpm\dummy\server.cpp

; 94   : 		sockaddr  socket_addr{ };

  001b4	33 c0		 xor	 eax, eax
  001b6	48 89 44 24 40	 mov	 QWORD PTR socket_addr$3[rsp], rax
  001bb	48 89 44 24 48	 mov	 QWORD PTR socket_addr$3[rsp+8], rax
; File c:\users\aapo\desktop\fortnite_shait\kernel rpm\dummy\ksocket\ksocket.c

; 540  :   KspAsyncContextReset(&Socket->AsyncContext);

  001c0	48 8d 5f 10	 lea	 rbx, QWORD PTR [rdi+16]

; 173  :   KeResetEvent(&AsyncContext->CompletionEvent);

  001c4	48 8b cb	 mov	 rcx, rbx
  001c7	ff 15 00 00 00
	00		 call	 QWORD PTR __imp_KeResetEvent

; 174  : 
; 175  :   //
; 176  :   // Reuse the IRP.
; 177  :   //
; 178  : 
; 179  :   IoReuseIrp(AsyncContext->Irp, STATUS_UNSUCCESSFUL);

  001cd	48 8b 4b 18	 mov	 rcx, QWORD PTR [rbx+24]
  001d1	ba 01 00 00 c0	 mov	 edx, -1073741823	; ffffffffc0000001H
  001d6	ff 15 00 00 00
	00		 call	 QWORD PTR __imp_IoReuseIrp
; File c:\program files (x86)\windows kits\10\include\10.0.17763.0\km\wdm.h

; 31468:     return ((Irp)->Tail.Overlay.CurrentStackLocation - 1 );

  001dc	48 8b 43 18	 mov	 rax, QWORD PTR [rbx+24]
; File c:\users\aapo\desktop\fortnite_shait\kernel rpm\dummy\ksocket\ksocket.c

; 546  :   Status = Socket->WskListenDispatch->WskAccept(

  001e0	45 33 c9	 xor	 r9d, r9d
  001e3	45 33 c0	 xor	 r8d, r8d
  001e6	33 d2		 xor	 edx, edx
; File c:\program files (x86)\windows kits\10\include\10.0.17763.0\km\wdm.h

; 31468:     return ((Irp)->Tail.Overlay.CurrentStackLocation - 1 );

  001e8	48 8b 88 b8 00
	00 00		 mov	 rcx, QWORD PTR [rax+184]

; 31851:     irpSp->CompletionRoutine = CompletionRoutine;

  001ef	4c 89 79 f0	 mov	 QWORD PTR [rcx-16], r15

; 31852:     irpSp->Context = Context;

  001f3	48 89 59 f8	 mov	 QWORD PTR [rcx-8], rbx

; 31853:     irpSp->Control = 0;
; 31854: 
; 31855:     if (InvokeOnSuccess) {
; 31856:         irpSp->Control = SL_INVOKE_ON_SUCCESS;
; 31857:     }
; 31858: 
; 31859:     if (InvokeOnError) {
; 31860:         irpSp->Control |= SL_INVOKE_ON_ERROR;
; 31861:     }
; 31862: 
; 31863:     if (InvokeOnCancel) {
; 31864:         irpSp->Control |= SL_INVOKE_ON_CANCEL;

  001f7	c6 41 bb e0	 mov	 BYTE PTR [rcx-69], 224	; 000000e0H
; File c:\users\aapo\desktop\fortnite_shait\kernel rpm\dummy\ksocket\ksocket.c

; 546  :   Status = Socket->WskListenDispatch->WskAccept(

  001fb	48 8b 47 28	 mov	 rax, QWORD PTR [rdi+40]
  001ff	4c 8b 57 08	 mov	 r10, QWORD PTR [rdi+8]
  00203	48 8b 0f	 mov	 rcx, QWORD PTR [rdi]
  00206	48 89 44 24 30	 mov	 QWORD PTR [rsp+48], rax
  0020b	48 8d 44 24 40	 lea	 rax, QWORD PTR socket_addr$3[rsp]
  00210	48 89 44 24 28	 mov	 QWORD PTR [rsp+40], rax
  00215	4c 89 74 24 20	 mov	 QWORD PTR [rsp+32], r14
  0021a	41 ff 52 18	 call	 QWORD PTR [r10+24]

; 213  :   if (*Status == STATUS_PENDING)

  0021e	3d 03 01 00 00	 cmp	 eax, 259		; 00000103H
  00223	75 1d		 jne	 SHORT $LN85@server_thr

; 214  :   {
; 215  :     KeWaitForSingleObject(

  00225	45 33 c9	 xor	 r9d, r9d
  00228	4c 89 74 24 20	 mov	 QWORD PTR [rsp+32], r14
  0022d	45 33 c0	 xor	 r8d, r8d
  00230	33 d2		 xor	 edx, edx
  00232	48 8b cb	 mov	 rcx, rbx
  00235	ff 15 00 00 00
	00		 call	 QWORD PTR __imp_KeWaitForSingleObject

; 216  :       &AsyncContext->CompletionEvent,
; 217  :       Executive,
; 218  :       KernelMode,
; 219  :       FALSE,
; 220  :       NULL
; 221  :       );
; 222  : 
; 223  :     *Status = AsyncContext->Irp->IoStatus.Status;

  0023b	48 8b 43 18	 mov	 rax, QWORD PTR [rbx+24]
  0023f	8b 40 30	 mov	 eax, DWORD PTR [rax+48]
$LN85@server_thr:

; 562  :   if (NT_SUCCESS(Status))

  00242	85 c0		 test	 eax, eax
  00244	0f 88 d6 00 00
	00		 js	 $LN3@server_thr

; 563  :   {
; 564  :     PKSOCKET KNewSocket = ExAllocatePoolWithTag(PagedPool, sizeof(KSOCKET), MEMORY_TAG);

  0024a	ba 30 00 00 00	 mov	 edx, 48			; 00000030H
  0024f	41 b8 61 34 66
	64		 mov	 r8d, 1684419681		; 64663461H
  00255	8d 4a d1	 lea	 ecx, QWORD PTR [rdx-47]
  00258	ff 15 00 00 00
	00		 call	 QWORD PTR __imp_ExAllocatePoolWithTag
  0025e	48 8b d8	 mov	 rbx, rax

; 565  : 
; 566  :     if (!KNewSocket)

  00261	48 85 c0	 test	 rax, rax
  00264	0f 84 b6 00 00
	00		 je	 $LN3@server_thr

; 567  :     {
; 568  :       return STATUS_INSUFFICIENT_RESOURCES;
; 569  :     }
; 570  : 
; 571  :     KNewSocket->WskSocket = (PWSK_SOCKET)Socket->AsyncContext.Irp->IoStatus.Information;

  0026a	48 8b 4f 28	 mov	 rcx, QWORD PTR [rdi+40]

; 97   :   KeInitializeEvent(

  0026e	45 33 c0	 xor	 r8d, r8d

; 573  :     KspAsyncContextAllocate(&KNewSocket->AsyncContext);

  00271	48 8d 78 10	 lea	 rdi, QWORD PTR [rax+16]
  00275	48 8b 49 38	 mov	 rcx, QWORD PTR [rcx+56]

; 97   :   KeInitializeEvent(

  00279	41 8d 50 01	 lea	 edx, QWORD PTR [r8+1]

; 571  :     KNewSocket->WskSocket = (PWSK_SOCKET)Socket->AsyncContext.Irp->IoStatus.Information;

  0027d	48 89 08	 mov	 QWORD PTR [rax], rcx

; 572  :     KNewSocket->WskDispatch = (PVOID)KNewSocket->WskSocket->Dispatch;

  00280	48 8b 09	 mov	 rcx, QWORD PTR [rcx]
  00283	48 89 48 08	 mov	 QWORD PTR [rax+8], rcx

; 97   :   KeInitializeEvent(

  00287	48 8b cf	 mov	 rcx, rdi
  0028a	ff 15 00 00 00
	00		 call	 QWORD PTR __imp_KeInitializeEvent

; 98   :     &AsyncContext->CompletionEvent,
; 99   :     SynchronizationEvent,
; 100  :     FALSE
; 101  :     );
; 102  : 
; 103  :   //
; 104  :   // Initialize the IRP.
; 105  :   //
; 106  : 
; 107  :   AsyncContext->Irp = IoAllocateIrp(1, FALSE);

  00290	33 d2		 xor	 edx, edx
  00292	b1 01		 mov	 cl, 1
  00294	ff 15 00 00 00
	00		 call	 QWORD PTR __imp_IoAllocateIrp
  0029a	48 89 47 18	 mov	 QWORD PTR [rdi+24], rax

; 108  : 
; 109  :   if (AsyncContext->Irp == NULL)

  0029e	48 85 c0	 test	 rax, rax
  002a1	74 13		 je	 SHORT $LN69@server_thr
; File c:\program files (x86)\windows kits\10\include\10.0.17763.0\km\wdm.h

; 31468:     return ((Irp)->Tail.Overlay.CurrentStackLocation - 1 );

  002a3	48 8b 80 b8 00
	00 00		 mov	 rax, QWORD PTR [rax+184]

; 31851:     irpSp->CompletionRoutine = CompletionRoutine;

  002aa	4c 89 78 f0	 mov	 QWORD PTR [rax-16], r15

; 31852:     irpSp->Context = Context;

  002ae	48 89 78 f8	 mov	 QWORD PTR [rax-8], rdi

; 31853:     irpSp->Control = 0;
; 31854: 
; 31855:     if (InvokeOnSuccess) {
; 31856:         irpSp->Control = SL_INVOKE_ON_SUCCESS;
; 31857:     }
; 31858: 
; 31859:     if (InvokeOnError) {
; 31860:         irpSp->Control |= SL_INVOKE_ON_ERROR;
; 31861:     }
; 31862: 
; 31863:     if (InvokeOnCancel) {
; 31864:         irpSp->Control |= SL_INVOKE_ON_CANCEL;

  002b2	c6 40 bb e0	 mov	 BYTE PTR [rax-69], 224	; 000000e0H
$LN69@server_thr:
; File c:\users\aapo\desktop\fortnite_shait\kernel rpm\dummy\ksocket\berkeley.c

; 595  :     int newsockfd = TO_SOCKETFD(KsIndex++);

  002b6	8b 0d 00 00 00
	00		 mov	 ecx, DWORD PTR KsIndex
; File c:\users\aapo\desktop\fortnite_shait\kernel rpm\dummy\server.cpp

; 108  : 		status = PsCreateSystemThread(

  002bc	45 33 c9	 xor	 r9d, r9d
; File c:\users\aapo\desktop\fortnite_shait\kernel rpm\dummy\ksocket\berkeley.c

; 595  :     int newsockfd = TO_SOCKETFD(KsIndex++);

  002bf	8b c1		 mov	 eax, ecx
; File c:\users\aapo\desktop\fortnite_shait\kernel rpm\dummy\server.cpp

; 104  : 		HANDLE thread_handle = nullptr;

  002c1	4c 89 b4 24 88
	00 00 00	 mov	 QWORD PTR thread_handle$5[rsp], r14
; File c:\users\aapo\desktop\fortnite_shait\kernel rpm\dummy\ksocket\berkeley.c

; 595  :     int newsockfd = TO_SOCKETFD(KsIndex++);

  002c9	83 e0 7f	 and	 eax, 127		; 0000007fH
  002cc	ff c1		 inc	 ecx
  002ce	89 0d 00 00 00
	00		 mov	 DWORD PTR KsIndex, ecx
; File c:\users\aapo\desktop\fortnite_shait\kernel rpm\dummy\server.cpp

; 108  : 		status = PsCreateSystemThread(

  002d4	45 33 c0	 xor	 r8d, r8d
  002d7	ba 00 00 00 10	 mov	 edx, 268435456		; 10000000H
  002dc	48 8d 8c 24 88
	00 00 00	 lea	 rcx, QWORD PTR thread_handle$5[rsp]
; File c:\users\aapo\desktop\fortnite_shait\kernel rpm\dummy\ksocket\berkeley.c

; 597  :     KsArray[FROM_SOCKETFD(newsockfd)] = NewSocket;

  002e4	49 89 1c c4	 mov	 QWORD PTR [r12+rax*8], rbx
  002e8	8d 58 01	 lea	 ebx, DWORD PTR [rax+1]
; File c:\users\aapo\desktop\fortnite_shait\kernel rpm\dummy\server.cpp

; 108  : 		status = PsCreateSystemThread(

  002eb	8b c3		 mov	 eax, ebx
  002ed	48 89 44 24 30	 mov	 QWORD PTR [rsp+48], rax
  002f2	4c 89 6c 24 28	 mov	 QWORD PTR [rsp+40], r13
  002f7	4c 89 74 24 20	 mov	 QWORD PTR [rsp+32], r14
  002fc	ff 15 00 00 00
	00		 call	 QWORD PTR __imp_PsCreateSystemThread

; 109  : 			&thread_handle,
; 110  : 			GENERIC_ALL,
; 111  : 			nullptr,
; 112  : 			nullptr,
; 113  : 			nullptr,
; 114  : 			connection_thread,
; 115  : 			(void*)client_connection
; 116  : 		);
; 117  : 
; 118  : 		if (!NT_SUCCESS(status))

  00302	85 c0		 test	 eax, eax
  00304	78 13		 js	 SHORT $LN76@server_thr

; 123  : 			break;
; 124  : 		}
; 125  : 
; 126  : 		ZwClose(thread_handle);

  00306	48 8b 8c 24 88
	00 00 00	 mov	 rcx, QWORD PTR thread_handle$5[rsp]
  0030e	ff 15 00 00 00
	00		 call	 QWORD PTR __imp_ZwClose

; 127  : 	}

  00314	e9 97 fe ff ff	 jmp	 $LL2@server_thr
$LN76@server_thr:

; 119  : 		{
; 120  : 			//log("Failed to create thread for handling client connection.");
; 121  : 
; 122  : 			closesocket(client_connection);

  00319	8b cb		 mov	 ecx, ebx
  0031b	e8 00 00 00 00	 call	 closesocket
$LN3@server_thr:

; 128  : 
; 129  : 	closesocket(listen_socket);

  00320	8b cd		 mov	 ecx, ebp
  00322	e8 00 00 00 00	 call	 closesocket
  00327	4c 8b 6c 24 58	 mov	 r13, QWORD PTR [rsp+88]
  0032c	e9 41 fe ff ff	 jmp	 $LN91@server_thr
?server_thread@@YAXPEAX@Z ENDP				; server_thread
_TEXT	ENDS
; Function compile flags: /Ogtp
; File c:\users\aapo\desktop\fortnite_shait\kernel rpm\dummy\server.cpp
; File c:\users\aapo\desktop\fortnite_shait\kernel rpm\dummy\ksocket\ksocket.c
; File c:\users\aapo\desktop\fortnite_shait\kernel rpm\dummy\server.cpp
; File c:\users\aapo\desktop\fortnite_shait\kernel rpm\dummy\ksocket\ksocket.c
; File c:\users\aapo\desktop\fortnite_shait\kernel rpm\dummy\ksocket\berkeley.c
; File c:\users\aapo\desktop\fortnite_shait\kernel rpm\dummy\ksocket\ksocket.c
; File c:\program files (x86)\windows kits\10\include\10.0.17763.0\km\wdm.h
; File c:\users\aapo\desktop\fortnite_shait\kernel rpm\dummy\ksocket\ksocket.c
; File c:\program files (x86)\windows kits\10\include\10.0.17763.0\km\wdm.h
; File c:\users\aapo\desktop\fortnite_shait\kernel rpm\dummy\ksocket\ksocket.c
; File c:\users\aapo\desktop\fortnite_shait\kernel rpm\dummy\ksocket\berkeley.c
; File c:\users\aapo\desktop\fortnite_shait\kernel rpm\dummy\server.cpp
;	COMDAT ?create_listen_socket@@YAHXZ
_TEXT	SEGMENT
address$ = 48
Socket$1 = 80
?create_listen_socket@@YAHXZ PROC			; create_listen_socket, COMDAT

; 9    : {

  00000	48 83 ec 48	 sub	 rsp, 72			; 00000048H

; 10   : 	SOCKADDR_IN address{ };

  00004	33 c0		 xor	 eax, eax
; File c:\users\aapo\desktop\fortnite_shait\kernel rpm\dummy\ksocket\ksocket.c

; 439  :   return KsCreateSocket(Socket, AddressFamily, SocketType, Protocol, WSK_FLAG_LISTEN_SOCKET);

  00006	48 8d 4c 24 50	 lea	 rcx, QWORD PTR Socket$1[rsp]
; File c:\users\aapo\desktop\fortnite_shait\kernel rpm\dummy\server.cpp

; 10   : 	SOCKADDR_IN address{ };

  0000b	48 89 44 24 30	 mov	 QWORD PTR address$[rsp], rax
  00010	48 89 44 24 38	 mov	 QWORD PTR address$[rsp+8], rax

; 11   : 
; 12   : 	address.sin_family	= AF_INET;

  00015	c7 44 24 30 02
	00 10 35	 mov	 DWORD PTR address$[rsp], 890241026 ; 35100002H
; File c:\users\aapo\desktop\fortnite_shait\kernel rpm\dummy\ksocket\ksocket.c

; 439  :   return KsCreateSocket(Socket, AddressFamily, SocketType, Protocol, WSK_FLAG_LISTEN_SOCKET);

  0001d	44 8d 48 06	 lea	 r9d, QWORD PTR [rax+6]
  00021	e8 00 00 00 00	 call	 KsCreateSocket
; File c:\users\aapo\desktop\fortnite_shait\kernel rpm\dummy\ksocket\berkeley.c

; 513  :   if (NT_SUCCESS(Status))

  00026	85 c0		 test	 eax, eax
  00028	0f 88 e0 00 00
	00		 js	 $LN31@create_lis

; 514  :   {
; 515  :     int sockfd = TO_SOCKETFD(KsIndex++);

  0002e	8b 0d 00 00 00
	00		 mov	 ecx, DWORD PTR KsIndex
  00034	8b d1		 mov	 edx, ecx

; 516  : 
; 517  :     KsArray[FROM_SOCKETFD(sockfd)] = Socket;

  00036	48 8b 44 24 50	 mov	 rax, QWORD PTR Socket$1[rsp]
  0003b	83 e2 7f	 and	 edx, 127		; 0000007fH
  0003e	48 89 5c 24 58	 mov	 QWORD PTR [rsp+88], rbx
  00043	ff c1		 inc	 ecx
  00045	48 89 74 24 60	 mov	 QWORD PTR [rsp+96], rsi
  0004a	48 8d 1d 00 00
	00 00		 lea	 rbx, OFFSET FLAT:KsArray
  00051	89 0d 00 00 00
	00		 mov	 DWORD PTR KsIndex, ecx
  00057	48 89 04 d3	 mov	 QWORD PTR [rbx+rdx*8], rax
  0005b	8d 72 01	 lea	 esi, DWORD PTR [rdx+1]
  0005e	48 89 7c 24 40	 mov	 QWORD PTR [rsp+64], rdi

; 575  :   PKSOCKET Socket = KsArray[FROM_SOCKETFD(sockfd)];

  00063	48 8b d8	 mov	 rbx, rax
; File c:\users\aapo\desktop\fortnite_shait\kernel rpm\dummy\ksocket\ksocket.c

; 507  :   KspAsyncContextReset(&Socket->AsyncContext);

  00066	48 8d 78 10	 lea	 rdi, QWORD PTR [rax+16]

; 173  :   KeResetEvent(&AsyncContext->CompletionEvent);

  0006a	48 8b cf	 mov	 rcx, rdi
  0006d	ff 15 00 00 00
	00		 call	 QWORD PTR __imp_KeResetEvent

; 174  : 
; 175  :   //
; 176  :   // Reuse the IRP.
; 177  :   //
; 178  : 
; 179  :   IoReuseIrp(AsyncContext->Irp, STATUS_UNSUCCESSFUL);

  00073	48 8b 4f 18	 mov	 rcx, QWORD PTR [rdi+24]
  00077	ba 01 00 00 c0	 mov	 edx, -1073741823	; ffffffffc0000001H
  0007c	ff 15 00 00 00
	00		 call	 QWORD PTR __imp_IoReuseIrp
; File c:\program files (x86)\windows kits\10\include\10.0.17763.0\km\wdm.h

; 31468:     return ((Irp)->Tail.Overlay.CurrentStackLocation - 1 );

  00082	48 8b 47 18	 mov	 rax, QWORD PTR [rdi+24]
; File c:\users\aapo\desktop\fortnite_shait\kernel rpm\dummy\ksocket\ksocket.c

; 513  :   Status = Socket->WskListenDispatch->WskBind(

  00086	48 8d 54 24 30	 lea	 rdx, QWORD PTR address$[rsp]
  0008b	45 33 c0	 xor	 r8d, r8d
; File c:\program files (x86)\windows kits\10\include\10.0.17763.0\km\wdm.h

; 31468:     return ((Irp)->Tail.Overlay.CurrentStackLocation - 1 );

  0008e	48 8b 88 b8 00
	00 00		 mov	 rcx, QWORD PTR [rax+184]

; 31851:     irpSp->CompletionRoutine = CompletionRoutine;

  00095	48 8d 05 00 00
	00 00		 lea	 rax, OFFSET FLAT:KspAsyncContextCompletionRoutine
  0009c	48 89 41 f0	 mov	 QWORD PTR [rcx-16], rax

; 31852:     irpSp->Context = Context;

  000a0	48 89 79 f8	 mov	 QWORD PTR [rcx-8], rdi

; 31853:     irpSp->Control = 0;
; 31854: 
; 31855:     if (InvokeOnSuccess) {
; 31856:         irpSp->Control = SL_INVOKE_ON_SUCCESS;
; 31857:     }
; 31858: 
; 31859:     if (InvokeOnError) {
; 31860:         irpSp->Control |= SL_INVOKE_ON_ERROR;
; 31861:     }
; 31862: 
; 31863:     if (InvokeOnCancel) {
; 31864:         irpSp->Control |= SL_INVOKE_ON_CANCEL;

  000a4	c6 41 bb e0	 mov	 BYTE PTR [rcx-69], 224	; 000000e0H
; File c:\users\aapo\desktop\fortnite_shait\kernel rpm\dummy\ksocket\ksocket.c

; 513  :   Status = Socket->WskListenDispatch->WskBind(

  000a8	48 8b 43 08	 mov	 rax, QWORD PTR [rbx+8]
  000ac	4c 8b 4b 28	 mov	 r9, QWORD PTR [rbx+40]
  000b0	48 8b 0b	 mov	 rcx, QWORD PTR [rbx]
  000b3	ff 50 10	 call	 QWORD PTR [rax+16]
  000b6	48 8b 5c 24 58	 mov	 rbx, QWORD PTR [rsp+88]

; 213  :   if (*Status == STATUS_PENDING)

  000bb	3d 03 01 00 00	 cmp	 eax, 259		; 00000103H
  000c0	75 21		 jne	 SHORT $LN27@create_lis

; 214  :   {
; 215  :     KeWaitForSingleObject(

  000c2	45 33 c9	 xor	 r9d, r9d
  000c5	48 c7 44 24 20
	00 00 00 00	 mov	 QWORD PTR [rsp+32], 0
  000ce	45 33 c0	 xor	 r8d, r8d
  000d1	33 d2		 xor	 edx, edx
  000d3	48 8b cf	 mov	 rcx, rdi
  000d6	ff 15 00 00 00
	00		 call	 QWORD PTR __imp_KeWaitForSingleObject

; 216  :       &AsyncContext->CompletionEvent,
; 217  :       Executive,
; 218  :       KernelMode,
; 219  :       FALSE,
; 220  :       NULL
; 221  :       );
; 222  : 
; 223  :     *Status = AsyncContext->Irp->IoStatus.Status;

  000dc	48 8b 47 18	 mov	 rax, QWORD PTR [rdi+24]
  000e0	8b 40 30	 mov	 eax, DWORD PTR [rax+48]
$LN27@create_lis:
  000e3	48 8b 7c 24 40	 mov	 rdi, QWORD PTR [rsp+64]
; File c:\users\aapo\desktop\fortnite_shait\kernel rpm\dummy\ksocket\berkeley.c

; 579  :   return NT_SUCCESS(Status)

  000e8	85 c0		 test	 eax, eax
; File c:\users\aapo\desktop\fortnite_shait\kernel rpm\dummy\server.cpp

; 22   : 	if (bind(listen_socket, (SOCKADDR*)&address, sizeof(address)) == SOCKET_ERROR)

  000ea	79 16		 jns	 SHORT $LN3@create_lis

; 23   : 	{
; 24   : 		//log("Failed to bind socket.");
; 25   : 
; 26   : 		closesocket(listen_socket);

  000ec	8b ce		 mov	 ecx, esi
  000ee	e8 00 00 00 00	 call	 closesocket
  000f3	48 8b 74 24 60	 mov	 rsi, QWORD PTR [rsp+96]

; 27   : 		return INVALID_SOCKET;

  000f8	b8 ff ff ff ff	 mov	 eax, -1

; 39   : }

  000fd	48 83 c4 48	 add	 rsp, 72			; 00000048H
  00101	c3		 ret	 0
$LN3@create_lis:

; 28   : 	}
; 29   : 
; 30   : 	if (listen(listen_socket, 10) == SOCKET_ERROR)
; 31   : 	{
; 32   : 		//log("Failed to set socket mode to listening.");
; 33   : 
; 34   : 		closesocket(listen_socket);
; 35   : 		return INVALID_SOCKET;
; 36   : 	}
; 37   : 
; 38   : 	return listen_socket;

  00102	8b c6		 mov	 eax, esi
  00104	48 8b 74 24 60	 mov	 rsi, QWORD PTR [rsp+96]

; 39   : }

  00109	48 83 c4 48	 add	 rsp, 72			; 00000048H
  0010d	c3		 ret	 0
$LN31@create_lis:

; 13   : 	address.sin_port	= htons(server_port);
; 14   : 
; 15   : 	const auto listen_socket = socket_listen(AF_INET, SOCK_STREAM, 0);
; 16   : 	if (listen_socket == INVALID_SOCKET)
; 17   : 	{
; 18   : 		//log("Failed to create listen socket.");
; 19   : 		return INVALID_SOCKET;

  0010e	b8 ff ff ff ff	 mov	 eax, -1

; 39   : }

  00113	48 83 c4 48	 add	 rsp, 72			; 00000048H
  00117	c3		 ret	 0
?create_listen_socket@@YAHXZ ENDP			; create_listen_socket
_TEXT	ENDS
; Function compile flags: /Ogtp
; File c:\users\aapo\desktop\fortnite_shait\kernel rpm\dummy\server.cpp
; File c:\users\aapo\desktop\fortnite_shait\kernel rpm\dummy\ksocket\berkeley.c
; File c:\users\aapo\desktop\fortnite_shait\kernel rpm\dummy\server.cpp
; File c:\users\aapo\desktop\fortnite_shait\kernel rpm\dummy\ksocket\berkeley.c
; File c:\users\aapo\desktop\fortnite_shait\kernel rpm\dummy\server.cpp
; File c:\users\aapo\desktop\fortnite_shait\kernel rpm\dummy\ksocket\ksocket.c
; File c:\users\aapo\desktop\fortnite_shait\kernel rpm\dummy\server.cpp
; File c:\users\aapo\desktop\fortnite_shait\kernel rpm\dummy\ksocket\berkeley.c
; File c:\users\aapo\desktop\fortnite_shait\kernel rpm\dummy\ksocket\ksocket.c
; File c:\users\aapo\desktop\fortnite_shait\kernel rpm\dummy\server.cpp
; File c:\users\aapo\desktop\fortnite_shait\kernel rpm\dummy\ksocket\berkeley.c
; File c:\users\aapo\desktop\fortnite_shait\kernel rpm\dummy\ksocket\ksocket.c
; File c:\users\aapo\desktop\fortnite_shait\kernel rpm\dummy\ksocket\berkeley.c
; File c:\users\aapo\desktop\fortnite_shait\kernel rpm\dummy\server.cpp
; File c:\users\aapo\desktop\fortnite_shait\kernel rpm\dummy\packet_handler.cpp
; File c:\users\aapo\desktop\fortnite_shait\kernel rpm\dummy\ksocket\berkeley.c
; File c:\users\aapo\desktop\fortnite_shait\kernel rpm\dummy\ksocket\ksocket.c
; File c:\users\aapo\desktop\fortnite_shait\kernel rpm\dummy\packet_handler.cpp
; File c:\users\aapo\desktop\fortnite_shait\kernel rpm\dummy\ksocket\ksocket.c
; File c:\users\aapo\desktop\fortnite_shait\kernel rpm\dummy\packet_handler.cpp
; File c:\users\aapo\desktop\fortnite_shait\kernel rpm\dummy\ksocket\berkeley.c
; File c:\users\aapo\desktop\fortnite_shait\kernel rpm\dummy\packet_handler.cpp
; File c:\users\aapo\desktop\fortnite_shait\kernel rpm\dummy\ksocket\ksocket.c
; File c:\users\aapo\desktop\fortnite_shait\kernel rpm\dummy\ksocket\berkeley.c
; File c:\users\aapo\desktop\fortnite_shait\kernel rpm\dummy\packet_handler.cpp
; File c:\users\aapo\desktop\fortnite_shait\kernel rpm\dummy\server.cpp
; File c:\users\aapo\desktop\fortnite_shait\kernel rpm\dummy\ksocket\berkeley.c
; File c:\users\aapo\desktop\fortnite_shait\kernel rpm\dummy\ksocket\ksocket.c
; File c:\users\aapo\desktop\fortnite_shait\kernel rpm\dummy\ksocket\berkeley.c
; File c:\users\aapo\desktop\fortnite_shait\kernel rpm\dummy\ksocket\ksocket.c
; File c:\users\aapo\desktop\fortnite_shait\kernel rpm\dummy\ksocket\berkeley.c
; File c:\users\aapo\desktop\fortnite_shait\kernel rpm\dummy\server.cpp
;	COMDAT ?connection_thread@@YAXPEAX@Z
_TEXT	SEGMENT
packet$ = 64
packet$3 = 112
Length$4 = 208
process$5 = 208
Length$6 = 208
dest_process$7 = 208
connection_socket$ = 208
src_process$8 = 216
return_size$9 = 224
?connection_thread@@YAXPEAX@Z PROC			; connection_thread, COMDAT

; 43   : {

  00000	40 55		 push	 rbp
  00002	56		 push	 rsi
  00003	57		 push	 rdi
  00004	41 57		 push	 r15
  00006	48 8d 6c 24 c1	 lea	 rbp, QWORD PTR [rsp-63]
  0000b	48 81 ec a8 00
	00 00		 sub	 rsp, 168		; 000000a8H

; 47   : 	Packet packet{ };

  00012	33 c0		 xor	 eax, eax
; File c:\users\aapo\desktop\fortnite_shait\kernel rpm\dummy\ksocket\berkeley.c

; 636  :   PKSOCKET Socket = KsArray[FROM_SOCKETFD(sockfd)];

  00014	48 63 f9	 movsxd	 rdi, ecx
; File c:\users\aapo\desktop\fortnite_shait\kernel rpm\dummy\server.cpp

; 43   : {

  00017	48 8b f1	 mov	 rsi, rcx

; 47   : 	Packet packet{ };

  0001a	48 89 45 d7	 mov	 QWORD PTR packet$[rbp-105], rax
; File c:\users\aapo\desktop\fortnite_shait\kernel rpm\dummy\ksocket\berkeley.c

; 636  :   PKSOCKET Socket = KsArray[FROM_SOCKETFD(sockfd)];

  0001e	4c 8d 3d 00 00
	00 00		 lea	 r15, OFFSET FLAT:KsArray
; File c:\users\aapo\desktop\fortnite_shait\kernel rpm\dummy\server.cpp

; 47   : 	Packet packet{ };

  00025	48 89 45 df	 mov	 QWORD PTR packet$[rbp-97], rax
; File c:\users\aapo\desktop\fortnite_shait\kernel rpm\dummy\ksocket\ksocket.c

; 854  :   return KsSendRecv(Socket, Buffer, Length, Flags, FALSE);

  00029	4c 8d 45 67	 lea	 r8, QWORD PTR Length$6[rbp-105]
; File c:\users\aapo\desktop\fortnite_shait\kernel rpm\dummy\server.cpp

; 47   : 	Packet packet{ };

  0002d	48 89 45 e7	 mov	 QWORD PTR packet$[rbp-89], rax
; File c:\users\aapo\desktop\fortnite_shait\kernel rpm\dummy\ksocket\berkeley.c

; 636  :   PKSOCKET Socket = KsArray[FROM_SOCKETFD(sockfd)];

  00031	49 8b 4c ff f8	 mov	 rcx, QWORD PTR [r15+rdi*8-8]
; File c:\users\aapo\desktop\fortnite_shait\kernel rpm\dummy\ksocket\ksocket.c

; 854  :   return KsSendRecv(Socket, Buffer, Length, Flags, FALSE);

  00036	48 8d 55 d7	 lea	 rdx, QWORD PTR packet$[rbp-105]
; File c:\users\aapo\desktop\fortnite_shait\kernel rpm\dummy\server.cpp

; 47   : 	Packet packet{ };

  0003a	48 89 45 ef	 mov	 QWORD PTR packet$[rbp-81], rax
  0003e	48 89 45 f7	 mov	 QWORD PTR packet$[rbp-73], rax
  00042	48 89 45 ff	 mov	 QWORD PTR packet$[rbp-65], rax
; File c:\users\aapo\desktop\fortnite_shait\kernel rpm\dummy\ksocket\berkeley.c

; 638  :   ULONG Length = (ULONG)len;

  00046	c7 45 67 30 00
	00 00		 mov	 DWORD PTR Length$6[rbp-105], 48 ; 00000030H
; File c:\users\aapo\desktop\fortnite_shait\kernel rpm\dummy\ksocket\ksocket.c

; 854  :   return KsSendRecv(Socket, Buffer, Length, Flags, FALSE);

  0004d	88 44 24 20	 mov	 BYTE PTR [rsp+32], al
  00051	e8 00 00 00 00	 call	 KsSendRecv
; File c:\users\aapo\desktop\fortnite_shait\kernel rpm\dummy\ksocket\berkeley.c

; 641  :   return NT_SUCCESS(Status)

  00056	85 c0		 test	 eax, eax
  00058	b9 ff ff ff ff	 mov	 ecx, -1
  0005d	0f 49 4d 67	 cmovns	 ecx, DWORD PTR Length$6[rbp-105]
; File c:\users\aapo\desktop\fortnite_shait\kernel rpm\dummy\server.cpp

; 51   : 		if (result <= 0)

  00061	85 c9		 test	 ecx, ecx
  00063	0f 8e 96 01 00
	00		 jle	 $LN41@connection
  00069	4c 89 b4 24 a0
	00 00 00	 mov	 QWORD PTR [rsp+160], r14
  00071	45 33 f6	 xor	 r14d, r14d
  00074	48 89 9c 24 e8
	00 00 00	 mov	 QWORD PTR [rsp+232], rbx
  0007c	0f 1f 40 00	 npad	 4
$LL2@connection:

; 52   : 			break;
; 53   : 
; 54   : 		if (result < sizeof(PacketHeader))

  00080	83 f9 08	 cmp	 ecx, 8
  00083	0f 82 35 01 00
	00		 jb	 $LN7@connection

; 55   : 			continue;
; 56   : 
; 57   : 		if (packet.header.magic != packet_magic)

  00089	81 7d d7 85 68
	45 54		 cmp	 DWORD PTR packet$[rbp-105], 1413834885 ; 54456885H
  00090	0f 85 28 01 00
	00		 jne	 $LN7@connection
; File c:\users\aapo\desktop\fortnite_shait\kernel rpm\dummy\packet_handler.cpp

; 55   : 	switch (packet.header.type)

  00096	8b 4d db	 mov	 ecx, DWORD PTR packet$[rbp-101]
  00099	85 c9		 test	 ecx, ecx
  0009b	74 44		 je	 SHORT $LN16@connection
  0009d	83 f9 01	 cmp	 ecx, 1
  000a0	74 0c		 je	 SHORT $LN17@connection

; 62   : 
; 63   : 	default:
; 64   : 		break;
; 65   : 	}
; 66   : 
; 67   : 	return uint64_t(STATUS_NOT_IMPLEMENTED);

  000a2	48 c7 c3 02 00
	00 c0		 mov	 rbx, -1073741822	; ffffffffc0000002H
  000a9	e9 c0 00 00 00	 jmp	 $LN20@connection
$LN17@connection:

; 41   : 	NTSTATUS  status  = PsLookupProcessByProcessId(HANDLE(packet.process_id), &process);

  000ae	8b 4d df	 mov	 ecx, DWORD PTR packet$[rbp-97]
  000b1	48 8d 55 67	 lea	 rdx, QWORD PTR process$5[rbp-105]
  000b5	4c 89 75 67	 mov	 QWORD PTR process$5[rbp-105], r14
  000b9	ff 15 00 00 00
	00		 call	 QWORD PTR __imp_PsLookupProcessByProcessId

; 42   : 
; 43   : 	if (!NT_SUCCESS(status))

  000bf	85 c0		 test	 eax, eax
  000c1	79 08		 jns	 SHORT $LN25@connection

; 44   : 		return 0;

  000c3	49 8b de	 mov	 rbx, r14
  000c6	e9 a3 00 00 00	 jmp	 $LN20@connection
$LN25@connection:

; 45   : 
; 46   : 	const auto base_address = uint64_t(PsGetProcessSectionBaseAddress(process));

  000cb	48 8b 4d 67	 mov	 rcx, QWORD PTR process$5[rbp-105]
  000cf	ff 15 00 00 00
	00		 call	 QWORD PTR __imp_PsGetProcessSectionBaseAddress

; 47   : 
; 48   : 	ObDereferenceObject(process);

  000d5	48 8b 4d 67	 mov	 rcx, QWORD PTR process$5[rbp-105]
  000d9	48 8b d8	 mov	 rbx, rax

; 61   : 		return handle_get_base_address(packet.data.get_base_address);

  000dc	e9 87 00 00 00	 jmp	 $LN44@connection
$LN16@connection:

; 10   : 	if (!NT_SUCCESS(PsLookupProcessByProcessId(HANDLE(packet.dest_process_id), &dest_process)))

  000e1	8b 4d df	 mov	 ecx, DWORD PTR packet$[rbp-97]
  000e4	48 8d 55 67	 lea	 rdx, QWORD PTR dest_process$7[rbp-105]
  000e8	4c 89 75 67	 mov	 QWORD PTR dest_process$7[rbp-105], r14
  000ec	4c 89 75 6f	 mov	 QWORD PTR src_process$8[rbp-105], r14
  000f0	ff 15 00 00 00
	00		 call	 QWORD PTR __imp_PsLookupProcessByProcessId
  000f6	85 c0		 test	 eax, eax
  000f8	79 09		 jns	 SHORT $LN21@connection

; 11   : 	{
; 12   : 		return uint64_t(STATUS_INVALID_CID);

  000fa	48 c7 c3 0b 00
	00 c0		 mov	 rbx, -1073741813	; ffffffffc000000bH
  00101	eb 6b		 jmp	 SHORT $LN20@connection
$LN21@connection:

; 13   : 	}
; 14   : 
; 15   : 	if (!NT_SUCCESS(PsLookupProcessByProcessId(HANDLE(packet.src_process_id), &src_process)))

  00103	8b 4d ef	 mov	 ecx, DWORD PTR packet$[rbp-81]
  00106	48 8d 55 6f	 lea	 rdx, QWORD PTR src_process$8[rbp-105]
  0010a	ff 15 00 00 00
	00		 call	 QWORD PTR __imp_PsLookupProcessByProcessId
  00110	85 c0		 test	 eax, eax
  00112	79 13		 jns	 SHORT $LN22@connection

; 16   : 	{
; 17   : 		ObDereferenceObject(dest_process);

  00114	48 8b 4d 67	 mov	 rcx, QWORD PTR dest_process$7[rbp-105]
  00118	ff 15 00 00 00
	00		 call	 QWORD PTR __imp_ObfDereferenceObject

; 18   : 		return uint64_t(STATUS_INVALID_CID);

  0011e	48 c7 c3 0b 00
	00 c0		 mov	 rbx, -1073741813	; ffffffffc000000bH
  00125	eb 47		 jmp	 SHORT $LN20@connection
$LN22@connection:

; 19   : 	}
; 20   : 
; 21   : 	SIZE_T   return_size = 0;
; 22   : 	NTSTATUS status = MmCopyVirtualMemory(

  00127	8b 45 ff	 mov	 eax, DWORD PTR packet$[rbp-65]
  0012a	48 8d 4d 77	 lea	 rcx, QWORD PTR return_size$9[rbp-105]
  0012e	4c 8b 4d e7	 mov	 r9, QWORD PTR packet$[rbp-89]
  00132	4c 8b 45 67	 mov	 r8, QWORD PTR dest_process$7[rbp-105]
  00136	48 8b 55 f7	 mov	 rdx, QWORD PTR packet$[rbp-73]
  0013a	48 89 4c 24 30	 mov	 QWORD PTR [rsp+48], rcx
  0013f	48 8b 4d 6f	 mov	 rcx, QWORD PTR src_process$8[rbp-105]
  00143	c6 44 24 28 01	 mov	 BYTE PTR [rsp+40], 1
  00148	48 89 44 24 20	 mov	 QWORD PTR [rsp+32], rax
  0014d	4c 89 75 77	 mov	 QWORD PTR return_size$9[rbp-105], r14
  00151	ff 15 00 00 00
	00		 call	 QWORD PTR __imp_MmCopyVirtualMemory

; 23   : 		src_process,
; 24   : 		(void*)packet.src_address,
; 25   : 		dest_process,
; 26   : 		(void*)packet.dest_address,
; 27   : 		packet.size,
; 28   : 		UserMode,
; 29   : 		&return_size
; 30   : 	);
; 31   : 
; 32   : 	ObDereferenceObject(dest_process);

  00157	48 8b 4d 67	 mov	 rcx, QWORD PTR dest_process$7[rbp-105]
  0015b	48 63 d8	 movsxd	 rbx, eax
  0015e	ff 15 00 00 00
	00		 call	 QWORD PTR __imp_ObfDereferenceObject

; 33   : 	ObDereferenceObject(src_process);

  00164	48 8b 4d 6f	 mov	 rcx, QWORD PTR src_process$8[rbp-105]
$LN44@connection:

; 73   : 	Packet packet{ };

  00168	ff 15 00 00 00
	00		 call	 QWORD PTR __imp_ObfDereferenceObject
$LN20@connection:
; File c:\users\aapo\desktop\fortnite_shait\kernel rpm\dummy\ksocket\berkeley.c

; 608  :   PKSOCKET Socket = KsArray[FROM_SOCKETFD(sockfd)];

  0016e	49 8b 4c ff f8	 mov	 rcx, QWORD PTR [r15+rdi*8-8]
; File c:\users\aapo\desktop\fortnite_shait\kernel rpm\dummy\ksocket\ksocket.c

; 842  :   return KsSendRecv(Socket, Buffer, Length, Flags, TRUE);

  00173	4c 8d 45 67	 lea	 r8, QWORD PTR Length$4[rbp-105]
  00177	0f 57 c0	 xorps	 xmm0, xmm0
; File c:\users\aapo\desktop\fortnite_shait\kernel rpm\dummy\packet_handler.cpp

; 75   : 	packet.header.magic				= packet_magic;

  0017a	c7 45 07 85 68
	45 54		 mov	 DWORD PTR packet$3[rbp-105], 1413834885 ; 54456885H
  00181	0f 57 c9	 xorps	 xmm1, xmm1

; 76   : 	packet.header.type				= PacketType::packet_completed;

  00184	c7 45 0b 02 00
	00 00		 mov	 DWORD PTR packet$3[rbp-101], 2
; File c:\users\aapo\desktop\fortnite_shait\kernel rpm\dummy\ksocket\ksocket.c

; 842  :   return KsSendRecv(Socket, Buffer, Length, Flags, TRUE);

  0018b	48 8d 55 07	 lea	 rdx, QWORD PTR packet$3[rbp-105]
; File c:\users\aapo\desktop\fortnite_shait\kernel rpm\dummy\packet_handler.cpp

; 77   : 	packet.data.completed.result	= result;

  0018f	48 89 5d 0f	 mov	 QWORD PTR packet$3[rbp-97], rbx
  00193	f3 0f 7f 45 17	 movdqu	 XMMWORD PTR packet$3[rbp-89], xmm0
; File c:\users\aapo\desktop\fortnite_shait\kernel rpm\dummy\ksocket\berkeley.c

; 610  :   ULONG Length = (ULONG)len;

  00198	c7 45 67 30 00
	00 00		 mov	 DWORD PTR Length$4[rbp-105], 48 ; 00000030H
; File c:\users\aapo\desktop\fortnite_shait\kernel rpm\dummy\packet_handler.cpp

; 73   : 	Packet packet{ };

  0019f	f3 0f 7f 4d 27	 movdqu	 XMMWORD PTR packet$3[rbp-73], xmm1
; File c:\users\aapo\desktop\fortnite_shait\kernel rpm\dummy\ksocket\ksocket.c

; 842  :   return KsSendRecv(Socket, Buffer, Length, Flags, TRUE);

  001a4	c6 44 24 20 01	 mov	 BYTE PTR [rsp+32], 1
  001a9	e8 00 00 00 00	 call	 KsSendRecv
; File c:\users\aapo\desktop\fortnite_shait\kernel rpm\dummy\ksocket\berkeley.c

; 613  :   return NT_SUCCESS(Status)

  001ae	85 c0		 test	 eax, eax
  001b0	b9 ff ff ff ff	 mov	 ecx, -1
  001b5	0f 49 4d 67	 cmovns	 ecx, DWORD PTR Length$4[rbp-105]
; File c:\users\aapo\desktop\fortnite_shait\kernel rpm\dummy\packet_handler.cpp

; 79   : 	return send(client_connection, &packet, sizeof(packet), 0) != SOCKET_ERROR;

  001b9	83 f9 ff	 cmp	 ecx, -1
; File c:\users\aapo\desktop\fortnite_shait\kernel rpm\dummy\server.cpp

; 61   : 		if (!complete_request(client_connection, packet_result))

  001bc	74 31		 je	 SHORT $LN43@connection
$LN7@connection:
; File c:\users\aapo\desktop\fortnite_shait\kernel rpm\dummy\ksocket\berkeley.c

; 636  :   PKSOCKET Socket = KsArray[FROM_SOCKETFD(sockfd)];

  001be	49 8b 4c ff f8	 mov	 rcx, QWORD PTR [r15+rdi*8-8]
; File c:\users\aapo\desktop\fortnite_shait\kernel rpm\dummy\ksocket\ksocket.c

; 854  :   return KsSendRecv(Socket, Buffer, Length, Flags, FALSE);

  001c3	4c 8d 45 67	 lea	 r8, QWORD PTR Length$6[rbp-105]
  001c7	48 8d 55 d7	 lea	 rdx, QWORD PTR packet$[rbp-105]
; File c:\users\aapo\desktop\fortnite_shait\kernel rpm\dummy\ksocket\berkeley.c

; 638  :   ULONG Length = (ULONG)len;

  001cb	c7 45 67 30 00
	00 00		 mov	 DWORD PTR Length$6[rbp-105], 48 ; 00000030H
; File c:\users\aapo\desktop\fortnite_shait\kernel rpm\dummy\ksocket\ksocket.c

; 854  :   return KsSendRecv(Socket, Buffer, Length, Flags, FALSE);

  001d2	44 88 74 24 20	 mov	 BYTE PTR [rsp+32], r14b
  001d7	e8 00 00 00 00	 call	 KsSendRecv
; File c:\users\aapo\desktop\fortnite_shait\kernel rpm\dummy\ksocket\berkeley.c

; 641  :   return NT_SUCCESS(Status)

  001dc	85 c0		 test	 eax, eax
  001de	b9 ff ff ff ff	 mov	 ecx, -1
  001e3	0f 49 4d 67	 cmovns	 ecx, DWORD PTR Length$6[rbp-105]
; File c:\users\aapo\desktop\fortnite_shait\kernel rpm\dummy\server.cpp

; 51   : 		if (result <= 0)

  001e7	85 c9		 test	 ecx, ecx
  001e9	0f 8f 91 fe ff
	ff		 jg	 $LL2@connection
$LN43@connection:
  001ef	48 8b 9c 24 e8
	00 00 00	 mov	 rbx, QWORD PTR [rsp+232]
  001f7	4c 8b b4 24 a0
	00 00 00	 mov	 r14, QWORD PTR [rsp+160]
$LN41@connection:

; 62   : 			break;
; 63   : 	}
; 64   : 
; 65   : 	//log("Connection closed.");
; 66   : 	closesocket(client_connection);

  001ff	8b ce		 mov	 ecx, esi
  00201	e8 00 00 00 00	 call	 closesocket

; 67   : }

  00206	48 81 c4 a8 00
	00 00		 add	 rsp, 168		; 000000a8H
  0020d	41 5f		 pop	 r15
  0020f	5f		 pop	 rdi
  00210	5e		 pop	 rsi
  00211	5d		 pop	 rbp
  00212	c3		 ret	 0
?connection_thread@@YAXPEAX@Z ENDP			; connection_thread
_TEXT	ENDS
END
