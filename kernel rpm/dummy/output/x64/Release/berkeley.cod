; Listing generated by Microsoft (R) Optimizing Compiler Version 19.16.27034.0 

include listing.inc

INCLUDELIB OLDNAMES

PUBLIC	KsIndex
PUBLIC	KsArray
EXTRN	__imp_ExFreePoolWithTag:PROC
EXTRN	__imp_ExAllocatePoolWithTag:PROC
EXTRN	__imp_RtlInitAnsiString:PROC
EXTRN	__imp_RtlUnicodeStringToAnsiString:PROC
EXTRN	__imp_RtlInitUnicodeString:PROC
EXTRN	__imp_RtlFreeUnicodeString:PROC
EXTRN	__imp_RtlAnsiStringToUnicodeString:PROC
EXTRN	__imp_RtlFreeAnsiString:PROC
KsIndex	DD	01H DUP (?)
	ALIGN	8

KsArray	DQ	080H DUP (?)
_BSS	ENDS
PUBLIC	closesocket
PUBLIC	recv
PUBLIC	send
PUBLIC	accept
PUBLIC	bind
PUBLIC	listen
PUBLIC	socket_listen
PUBLIC	htons
EXTRN	__C_specific_handler:PROC
EXTRN	memset:PROC
EXTRN	strcmp:PROC
EXTRN	__ImageBase:BYTE
;	COMDAT pdata
pdata	SEGMENT
$pdata$closesocket DD imagerel $LN20
	DD	imagerel $LN20+213
	DD	imagerel $unwind$closesocket
pdata	ENDS
;	COMDAT pdata
pdata	SEGMENT
$pdata$recv DD	imagerel $LN6
	DD	imagerel $LN6+66
	DD	imagerel $unwind$recv
pdata	ENDS
;	COMDAT pdata
pdata	SEGMENT
$pdata$send DD	imagerel $LN6
	DD	imagerel $LN6+66
	DD	imagerel $unwind$send
pdata	ENDS
;	COMDAT pdata
pdata	SEGMENT
$pdata$accept DD imagerel $LN32
	DD	imagerel $LN32+377
	DD	imagerel $unwind$accept
pdata	ENDS
;	COMDAT pdata
pdata	SEGMENT
$pdata$bind DD	imagerel $LN18
	DD	imagerel $LN18+170
	DD	imagerel $unwind$bind
pdata	ENDS
;	COMDAT pdata
pdata	SEGMENT
$pdata$socket_listen DD imagerel $LN7
	DD	imagerel $LN7+77
	DD	imagerel $unwind$socket_listen
;	COMDAT xdata
xdata	SEGMENT
$unwind$socket_listen DD 030402H
	DD	060b1601H
	DD	06204H
xdata	ENDS
;	COMDAT xdata
xdata	SEGMENT
$unwind$bind DD	080f02H
	DD	06001602H
	DD	09640fH
	DD	08340fH
	DD	0700b520fH
xdata	ENDS
;	COMDAT xdata
xdata	SEGMENT
$unwind$accept DD 0c1602H
	DD	06880609H
	DD	0f5416H
	DD	0e3416H
	DD	0f0127216H
	DD	0c00ee010H
	DD	0600b700cH
xdata	ENDS
;	COMDAT xdata
xdata	SEGMENT
$unwind$send DD	030902H
	DD	06001601H
	DD	06209H
xdata	ENDS
;	COMDAT xdata
xdata	SEGMENT
$unwind$recv DD	030902H
	DD	06001601H
	DD	06209H
xdata	ENDS
;	COMDAT xdata
xdata	SEGMENT
$unwind$closesocket DD 0a1502H
	DD	06001603H
	DD	0a7415H
	DD	096415H
	DD	083415H
	DD	0e0115215H
xdata	ENDS
; Function compile flags: /Ogtp
; File c:\users\aapo\desktop\fortnite_shait\kernel rpm\dummy\ksocket\berkeley.c
;	COMDAT htons
_TEXT	SEGMENT
hostshort$dead$ = 8
htons	PROC						; COMDAT

; 345  :   return RtlUshortByteSwap(hostshort);

  00000	b8 10 35 00 00	 mov	 eax, 13584		; 00003510H

; 346  : }

  00005	c3		 ret	 0
htons	ENDP
_TEXT	ENDS
; Function compile flags: /Ogtp
; File c:\users\aapo\desktop\fortnite_shait\kernel rpm\dummy\ksocket\berkeley.c
; File c:\users\aapo\desktop\fortnite_shait\kernel rpm\dummy\ksocket\ksocket.c
; File c:\users\aapo\desktop\fortnite_shait\kernel rpm\dummy\ksocket\berkeley.c
;	COMDAT socket_listen
_TEXT	SEGMENT
domain$dead$ = 64
type$dead$ = 72
protocol$dead$ = 80
Socket$ = 88
socket_listen PROC					; COMDAT

; 497  : {

$LN7:
  00000	48 83 ec 38	 sub	 rsp, 56			; 00000038H
; File c:\users\aapo\desktop\fortnite_shait\kernel rpm\dummy\ksocket\ksocket.c

; 439  :   return KsCreateSocket(Socket, AddressFamily, SocketType, Protocol, WSK_FLAG_LISTEN_SOCKET);

  00004	41 b9 06 00 00
	00		 mov	 r9d, 6
  0000a	48 8d 4c 24 58	 lea	 rcx, QWORD PTR Socket$[rsp]
  0000f	e8 00 00 00 00	 call	 KsCreateSocket
; File c:\users\aapo\desktop\fortnite_shait\kernel rpm\dummy\ksocket\berkeley.c

; 513  :   if (NT_SUCCESS(Status))

  00014	85 c0		 test	 eax, eax
  00016	78 2b		 js	 SHORT $LN2@socket_lis

; 514  :   {
; 515  :     int sockfd = TO_SOCKETFD(KsIndex++);

  00018	8b 0d 00 00 00
	00		 mov	 ecx, DWORD PTR KsIndex
  0001e	8b d1		 mov	 edx, ecx

; 516  : 
; 517  :     KsArray[FROM_SOCKETFD(sockfd)] = Socket;

  00020	48 8b 44 24 58	 mov	 rax, QWORD PTR Socket$[rsp]
  00025	83 e2 7f	 and	 edx, 127		; 0000007fH
  00028	ff c1		 inc	 ecx
  0002a	89 0d 00 00 00
	00		 mov	 DWORD PTR KsIndex, ecx
  00030	48 8d 0d 00 00
	00 00		 lea	 rcx, OFFSET FLAT:KsArray
  00037	48 89 04 d1	 mov	 QWORD PTR [rcx+rdx*8], rax
  0003b	8d 42 01	 lea	 eax, DWORD PTR [rdx+1]

; 523  : }

  0003e	48 83 c4 38	 add	 rsp, 56			; 00000038H
  00042	c3		 ret	 0
$LN2@socket_lis:

; 518  : 
; 519  :     return sockfd;
; 520  :   }
; 521  : 
; 522  :   return -1;

  00043	b8 ff ff ff ff	 mov	 eax, -1

; 523  : }

  00048	48 83 c4 38	 add	 rsp, 56			; 00000038H
  0004c	c3		 ret	 0
socket_listen ENDP
_TEXT	ENDS
; Function compile flags: /Ogtp
; File c:\users\aapo\desktop\fortnite_shait\kernel rpm\dummy\ksocket\berkeley.c
;	COMDAT listen
_TEXT	SEGMENT
sockfd$dead$ = 8
backlog$dead$ = 16
listen	PROC						; COMDAT

; 565  :   UNREFERENCED_PARAMETER(sockfd);
; 566  :   UNREFERENCED_PARAMETER(backlog);
; 567  :   return 0;

  00000	33 c0		 xor	 eax, eax

; 568  : }

  00002	c3		 ret	 0
listen	ENDP
_TEXT	ENDS
; Function compile flags: /Ogtp
; File c:\users\aapo\desktop\fortnite_shait\kernel rpm\dummy\ksocket\berkeley.c
; File c:\users\aapo\desktop\fortnite_shait\kernel rpm\dummy\ksocket\ksocket.c
; File c:\program files (x86)\windows kits\10\include\10.0.17763.0\km\wdm.h
; File c:\users\aapo\desktop\fortnite_shait\kernel rpm\dummy\ksocket\ksocket.c
; File c:\program files (x86)\windows kits\10\include\10.0.17763.0\km\wdm.h
; File c:\users\aapo\desktop\fortnite_shait\kernel rpm\dummy\ksocket\ksocket.c
; File c:\users\aapo\desktop\fortnite_shait\kernel rpm\dummy\ksocket\berkeley.c
;	COMDAT bind
_TEXT	SEGMENT
sockfd$ = 64
addr$ = 72
addrlen$dead$ = 80
bind	PROC						; COMDAT

; 571  : {

$LN18:
  00000	48 89 5c 24 08	 mov	 QWORD PTR [rsp+8], rbx
  00005	48 89 74 24 10	 mov	 QWORD PTR [rsp+16], rsi
  0000a	57		 push	 rdi
  0000b	48 83 ec 30	 sub	 rsp, 48			; 00000030H

; 572  :   UNREFERENCED_PARAMETER(addrlen);
; 573  : 
; 574  :   NTSTATUS Status;
; 575  :   PKSOCKET Socket = KsArray[FROM_SOCKETFD(sockfd)];

  0000f	48 63 c1	 movsxd	 rax, ecx
  00012	48 8d 1d 00 00
	00 00		 lea	 rbx, OFFSET FLAT:KsArray
  00019	48 8b fa	 mov	 rdi, rdx
  0001c	48 8b 5c c3 f8	 mov	 rbx, QWORD PTR [rbx+rax*8-8]
; File c:\users\aapo\desktop\fortnite_shait\kernel rpm\dummy\ksocket\ksocket.c

; 507  :   KspAsyncContextReset(&Socket->AsyncContext);

  00021	48 8d 73 10	 lea	 rsi, QWORD PTR [rbx+16]

; 173  :   KeResetEvent(&AsyncContext->CompletionEvent);

  00025	48 8b ce	 mov	 rcx, rsi
  00028	ff 15 00 00 00
	00		 call	 QWORD PTR __imp_KeResetEvent

; 174  : 
; 175  :   //
; 176  :   // Reuse the IRP.
; 177  :   //
; 178  : 
; 179  :   IoReuseIrp(AsyncContext->Irp, STATUS_UNSUCCESSFUL);

  0002e	48 8b 4e 18	 mov	 rcx, QWORD PTR [rsi+24]
  00032	ba 01 00 00 c0	 mov	 edx, -1073741823	; ffffffffc0000001H
  00037	ff 15 00 00 00
	00		 call	 QWORD PTR __imp_IoReuseIrp
; File c:\program files (x86)\windows kits\10\include\10.0.17763.0\km\wdm.h

; 31468:     return ((Irp)->Tail.Overlay.CurrentStackLocation - 1 );

  0003d	48 8b 46 18	 mov	 rax, QWORD PTR [rsi+24]
; File c:\users\aapo\desktop\fortnite_shait\kernel rpm\dummy\ksocket\ksocket.c

; 513  :   Status = Socket->WskListenDispatch->WskBind(

  00041	45 33 c0	 xor	 r8d, r8d
; File c:\program files (x86)\windows kits\10\include\10.0.17763.0\km\wdm.h

; 31468:     return ((Irp)->Tail.Overlay.CurrentStackLocation - 1 );

  00044	48 8b 90 b8 00
	00 00		 mov	 rdx, QWORD PTR [rax+184]

; 31851:     irpSp->CompletionRoutine = CompletionRoutine;

  0004b	48 8d 05 00 00
	00 00		 lea	 rax, OFFSET FLAT:KspAsyncContextCompletionRoutine
  00052	48 89 42 f0	 mov	 QWORD PTR [rdx-16], rax

; 31852:     irpSp->Context = Context;

  00056	48 89 72 f8	 mov	 QWORD PTR [rdx-8], rsi

; 31853:     irpSp->Control = 0;
; 31854: 
; 31855:     if (InvokeOnSuccess) {
; 31856:         irpSp->Control = SL_INVOKE_ON_SUCCESS;
; 31857:     }
; 31858: 
; 31859:     if (InvokeOnError) {
; 31860:         irpSp->Control |= SL_INVOKE_ON_ERROR;
; 31861:     }
; 31862: 
; 31863:     if (InvokeOnCancel) {
; 31864:         irpSp->Control |= SL_INVOKE_ON_CANCEL;

  0005a	c6 42 bb e0	 mov	 BYTE PTR [rdx-69], 224	; 000000e0H
; File c:\users\aapo\desktop\fortnite_shait\kernel rpm\dummy\ksocket\ksocket.c

; 513  :   Status = Socket->WskListenDispatch->WskBind(

  0005e	48 8b d7	 mov	 rdx, rdi
  00061	48 8b 43 08	 mov	 rax, QWORD PTR [rbx+8]
  00065	4c 8b 4b 28	 mov	 r9, QWORD PTR [rbx+40]
  00069	48 8b 0b	 mov	 rcx, QWORD PTR [rbx]
  0006c	ff 50 10	 call	 QWORD PTR [rax+16]

; 213  :   if (*Status == STATUS_PENDING)

  0006f	3d 03 01 00 00	 cmp	 eax, 259		; 00000103H
  00074	75 21		 jne	 SHORT $LN15@bind

; 214  :   {
; 215  :     KeWaitForSingleObject(

  00076	45 33 c9	 xor	 r9d, r9d
  00079	48 c7 44 24 20
	00 00 00 00	 mov	 QWORD PTR [rsp+32], 0
  00082	45 33 c0	 xor	 r8d, r8d
  00085	33 d2		 xor	 edx, edx
  00087	48 8b ce	 mov	 rcx, rsi
  0008a	ff 15 00 00 00
	00		 call	 QWORD PTR __imp_KeWaitForSingleObject

; 216  :       &AsyncContext->CompletionEvent,
; 217  :       Executive,
; 218  :       KernelMode,
; 219  :       FALSE,
; 220  :       NULL
; 221  :       );
; 222  : 
; 223  :     *Status = AsyncContext->Irp->IoStatus.Status;

  00090	48 8b 46 18	 mov	 rax, QWORD PTR [rsi+24]
  00094	8b 40 30	 mov	 eax, DWORD PTR [rax+48]
$LN15@bind:
; File c:\users\aapo\desktop\fortnite_shait\kernel rpm\dummy\ksocket\berkeley.c

; 582  : }

  00097	48 8b 5c 24 40	 mov	 rbx, QWORD PTR [rsp+64]
  0009c	48 8b 74 24 48	 mov	 rsi, QWORD PTR [rsp+72]
  000a1	c1 f8 1f	 sar	 eax, 31
  000a4	48 83 c4 30	 add	 rsp, 48			; 00000030H
  000a8	5f		 pop	 rdi
  000a9	c3		 ret	 0
bind	ENDP
_TEXT	ENDS
; Function compile flags: /Ogtp
; File c:\users\aapo\desktop\fortnite_shait\kernel rpm\dummy\ksocket\berkeley.c
; File c:\users\aapo\desktop\fortnite_shait\kernel rpm\dummy\ksocket\ksocket.c
; File c:\program files (x86)\windows kits\10\include\10.0.17763.0\km\wdm.h
; File c:\users\aapo\desktop\fortnite_shait\kernel rpm\dummy\ksocket\ksocket.c
; File c:\program files (x86)\windows kits\10\include\10.0.17763.0\km\wdm.h
; File c:\users\aapo\desktop\fortnite_shait\kernel rpm\dummy\ksocket\ksocket.c
; File c:\users\aapo\desktop\fortnite_shait\kernel rpm\dummy\ksocket\berkeley.c
; File c:\users\aapo\desktop\fortnite_shait\kernel rpm\dummy\ksocket\ksocket.c
; File c:\program files (x86)\windows kits\10\include\10.0.17763.0\km\wdm.h
; File c:\users\aapo\desktop\fortnite_shait\kernel rpm\dummy\ksocket\ksocket.c
; File c:\users\aapo\desktop\fortnite_shait\kernel rpm\dummy\ksocket\berkeley.c
;	COMDAT accept
_TEXT	SEGMENT
sockfd$ = 112
addr$ = 120
NewSocket$ = 128
addrlen$ = 128
accept	PROC						; COMDAT

; 585  : {

$LN32:
  00000	48 89 5c 24 08	 mov	 QWORD PTR [rsp+8], rbx
  00005	48 89 6c 24 10	 mov	 QWORD PTR [rsp+16], rbp
  0000a	56		 push	 rsi
  0000b	57		 push	 rdi
  0000c	41 54		 push	 r12
  0000e	41 56		 push	 r14
  00010	41 57		 push	 r15
  00012	48 83 ec 40	 sub	 rsp, 64			; 00000040H

; 586  :   NTSTATUS Status;
; 587  :   PKSOCKET Socket = KsArray[FROM_SOCKETFD(sockfd)];

  00016	48 63 c1	 movsxd	 rax, ecx
  00019	4c 8d 25 00 00
	00 00		 lea	 r12, OFFSET FLAT:KsArray
  00020	4d 8b f0	 mov	 r14, r8
  00023	48 8b da	 mov	 rbx, rdx
  00026	4d 8b 7c c4 f8	 mov	 r15, QWORD PTR [r12+rax*8-8]
; File c:\users\aapo\desktop\fortnite_shait\kernel rpm\dummy\ksocket\ksocket.c

; 540  :   KspAsyncContextReset(&Socket->AsyncContext);

  0002b	49 8d 77 10	 lea	 rsi, QWORD PTR [r15+16]

; 173  :   KeResetEvent(&AsyncContext->CompletionEvent);

  0002f	48 8b ce	 mov	 rcx, rsi
  00032	ff 15 00 00 00
	00		 call	 QWORD PTR __imp_KeResetEvent

; 174  : 
; 175  :   //
; 176  :   // Reuse the IRP.
; 177  :   //
; 178  : 
; 179  :   IoReuseIrp(AsyncContext->Irp, STATUS_UNSUCCESSFUL);

  00038	48 8b 4e 18	 mov	 rcx, QWORD PTR [rsi+24]
  0003c	ba 01 00 00 c0	 mov	 edx, -1073741823	; ffffffffc0000001H
  00041	ff 15 00 00 00
	00		 call	 QWORD PTR __imp_IoReuseIrp
; File c:\program files (x86)\windows kits\10\include\10.0.17763.0\km\wdm.h

; 31468:     return ((Irp)->Tail.Overlay.CurrentStackLocation - 1 );

  00047	48 8b 46 18	 mov	 rax, QWORD PTR [rsi+24]

; 31851:     irpSp->CompletionRoutine = CompletionRoutine;

  0004b	48 8d 2d 00 00
	00 00		 lea	 rbp, OFFSET FLAT:KspAsyncContextCompletionRoutine
; File c:\users\aapo\desktop\fortnite_shait\kernel rpm\dummy\ksocket\ksocket.c

; 546  :   Status = Socket->WskListenDispatch->WskAccept(

  00052	45 33 c9	 xor	 r9d, r9d
  00055	45 33 c0	 xor	 r8d, r8d
  00058	33 d2		 xor	 edx, edx
; File c:\program files (x86)\windows kits\10\include\10.0.17763.0\km\wdm.h

; 31468:     return ((Irp)->Tail.Overlay.CurrentStackLocation - 1 );

  0005a	48 8b 88 b8 00
	00 00		 mov	 rcx, QWORD PTR [rax+184]

; 31851:     irpSp->CompletionRoutine = CompletionRoutine;

  00061	48 89 69 f0	 mov	 QWORD PTR [rcx-16], rbp

; 31852:     irpSp->Context = Context;

  00065	48 89 71 f8	 mov	 QWORD PTR [rcx-8], rsi

; 31853:     irpSp->Control = 0;
; 31854: 
; 31855:     if (InvokeOnSuccess) {
; 31856:         irpSp->Control = SL_INVOKE_ON_SUCCESS;
; 31857:     }
; 31858: 
; 31859:     if (InvokeOnError) {
; 31860:         irpSp->Control |= SL_INVOKE_ON_ERROR;
; 31861:     }
; 31862: 
; 31863:     if (InvokeOnCancel) {
; 31864:         irpSp->Control |= SL_INVOKE_ON_CANCEL;

  00069	c6 41 bb e0	 mov	 BYTE PTR [rcx-69], 224	; 000000e0H
; File c:\users\aapo\desktop\fortnite_shait\kernel rpm\dummy\ksocket\ksocket.c

; 546  :   Status = Socket->WskListenDispatch->WskAccept(

  0006d	49 8b 47 28	 mov	 rax, QWORD PTR [r15+40]
  00071	4d 8b 57 08	 mov	 r10, QWORD PTR [r15+8]
  00075	49 8b 0f	 mov	 rcx, QWORD PTR [r15]
  00078	48 89 44 24 30	 mov	 QWORD PTR [rsp+48], rax
  0007d	48 89 5c 24 28	 mov	 QWORD PTR [rsp+40], rbx
  00082	33 db		 xor	 ebx, ebx
  00084	48 89 5c 24 20	 mov	 QWORD PTR [rsp+32], rbx
  00089	41 ff 52 18	 call	 QWORD PTR [r10+24]
  0008d	8b f8		 mov	 edi, eax

; 213  :   if (*Status == STATUS_PENDING)

  0008f	3d 03 01 00 00	 cmp	 eax, 259		; 00000103H
  00094	75 1d		 jne	 SHORT $LN18@accept

; 214  :   {
; 215  :     KeWaitForSingleObject(

  00096	45 33 c9	 xor	 r9d, r9d
  00099	48 89 5c 24 20	 mov	 QWORD PTR [rsp+32], rbx
  0009e	45 33 c0	 xor	 r8d, r8d
  000a1	33 d2		 xor	 edx, edx
  000a3	48 8b ce	 mov	 rcx, rsi
  000a6	ff 15 00 00 00
	00		 call	 QWORD PTR __imp_KeWaitForSingleObject

; 216  :       &AsyncContext->CompletionEvent,
; 217  :       Executive,
; 218  :       KernelMode,
; 219  :       FALSE,
; 220  :       NULL
; 221  :       );
; 222  : 
; 223  :     *Status = AsyncContext->Irp->IoStatus.Status;

  000ac	48 8b 46 18	 mov	 rax, QWORD PTR [rsi+24]
  000b0	8b 78 30	 mov	 edi, DWORD PTR [rax+48]
$LN18@accept:

; 562  :   if (NT_SUCCESS(Status))

  000b3	85 ff		 test	 edi, edi
  000b5	0f 88 8d 00 00
	00		 js	 $LN30@accept

; 563  :   {
; 564  :     PKSOCKET KNewSocket = ExAllocatePoolWithTag(PagedPool, sizeof(KSOCKET), MEMORY_TAG);

  000bb	ba 30 00 00 00	 mov	 edx, 48			; 00000030H
  000c0	41 b8 61 34 66
	64		 mov	 r8d, 1684419681		; 64663461H
  000c6	8d 4a d1	 lea	 ecx, QWORD PTR [rdx-47]
  000c9	ff 15 00 00 00
	00		 call	 QWORD PTR __imp_ExAllocatePoolWithTag
  000cf	48 8b d8	 mov	 rbx, rax

; 565  : 
; 566  :     if (!KNewSocket)

  000d2	48 85 c0	 test	 rax, rax
  000d5	75 23		 jne	 SHORT $LN6@accept
; File c:\users\aapo\desktop\fortnite_shait\kernel rpm\dummy\ksocket\berkeley.c

; 591  :   *addrlen = sizeof(SOCKADDR);

  000d7	41 c7 06 10 00
	00 00		 mov	 DWORD PTR [r14], 16
$LN2@accept:

; 600  :   }
; 601  : 
; 602  :   return -1;

  000de	b8 ff ff ff ff	 mov	 eax, -1
$LN1@accept:

; 603  : }

  000e3	48 8b 5c 24 70	 mov	 rbx, QWORD PTR [rsp+112]
  000e8	48 8b 6c 24 78	 mov	 rbp, QWORD PTR [rsp+120]
  000ed	48 83 c4 40	 add	 rsp, 64			; 00000040H
  000f1	41 5f		 pop	 r15
  000f3	41 5e		 pop	 r14
  000f5	41 5c		 pop	 r12
  000f7	5f		 pop	 rdi
  000f8	5e		 pop	 rsi
  000f9	c3		 ret	 0
$LN6@accept:
; File c:\users\aapo\desktop\fortnite_shait\kernel rpm\dummy\ksocket\ksocket.c

; 571  :     KNewSocket->WskSocket = (PWSK_SOCKET)Socket->AsyncContext.Irp->IoStatus.Information;

  000fa	49 8b 47 28	 mov	 rax, QWORD PTR [r15+40]

; 573  :     KspAsyncContextAllocate(&KNewSocket->AsyncContext);

  000fe	48 8d 73 10	 lea	 rsi, QWORD PTR [rbx+16]

; 97   :   KeInitializeEvent(

  00102	45 33 c0	 xor	 r8d, r8d
  00105	48 8b ce	 mov	 rcx, rsi

; 571  :     KNewSocket->WskSocket = (PWSK_SOCKET)Socket->AsyncContext.Irp->IoStatus.Information;

  00108	48 8b 40 38	 mov	 rax, QWORD PTR [rax+56]
  0010c	48 89 03	 mov	 QWORD PTR [rbx], rax

; 97   :   KeInitializeEvent(

  0010f	41 8d 50 01	 lea	 edx, QWORD PTR [r8+1]

; 572  :     KNewSocket->WskDispatch = (PVOID)KNewSocket->WskSocket->Dispatch;

  00113	48 8b 00	 mov	 rax, QWORD PTR [rax]
  00116	48 89 43 08	 mov	 QWORD PTR [rbx+8], rax

; 97   :   KeInitializeEvent(

  0011a	ff 15 00 00 00
	00		 call	 QWORD PTR __imp_KeInitializeEvent

; 98   :     &AsyncContext->CompletionEvent,
; 99   :     SynchronizationEvent,
; 100  :     FALSE
; 101  :     );
; 102  : 
; 103  :   //
; 104  :   // Initialize the IRP.
; 105  :   //
; 106  : 
; 107  :   AsyncContext->Irp = IoAllocateIrp(1, FALSE);

  00120	33 d2		 xor	 edx, edx
  00122	b1 01		 mov	 cl, 1
  00124	ff 15 00 00 00
	00		 call	 QWORD PTR __imp_IoAllocateIrp
  0012a	48 89 46 18	 mov	 QWORD PTR [rsi+24], rax

; 108  : 
; 109  :   if (AsyncContext->Irp == NULL)

  0012e	48 85 c0	 test	 rax, rax
  00131	74 1d		 je	 SHORT $LN5@accept
; File c:\program files (x86)\windows kits\10\include\10.0.17763.0\km\wdm.h

; 31468:     return ((Irp)->Tail.Overlay.CurrentStackLocation - 1 );

  00133	48 8b 80 b8 00
	00 00		 mov	 rax, QWORD PTR [rax+184]

; 31851:     irpSp->CompletionRoutine = CompletionRoutine;

  0013a	48 89 68 f0	 mov	 QWORD PTR [rax-16], rbp

; 31852:     irpSp->Context = Context;

  0013e	48 89 70 f8	 mov	 QWORD PTR [rax-8], rsi

; 31853:     irpSp->Control = 0;
; 31854: 
; 31855:     if (InvokeOnSuccess) {
; 31856:         irpSp->Control = SL_INVOKE_ON_SUCCESS;
; 31857:     }
; 31858: 
; 31859:     if (InvokeOnError) {
; 31860:         irpSp->Control |= SL_INVOKE_ON_ERROR;
; 31861:     }
; 31862: 
; 31863:     if (InvokeOnCancel) {
; 31864:         irpSp->Control |= SL_INVOKE_ON_CANCEL;

  00142	c6 40 bb e0	 mov	 BYTE PTR [rax-69], 224	; 000000e0H
; File c:\users\aapo\desktop\fortnite_shait\kernel rpm\dummy\ksocket\ksocket.c

; 562  :   if (NT_SUCCESS(Status))

  00146	eb 08		 jmp	 SHORT $LN5@accept
$LN30@accept:
  00148	48 8b 9c 24 80
	00 00 00	 mov	 rbx, QWORD PTR NewSocket$[rsp]
$LN5@accept:
; File c:\users\aapo\desktop\fortnite_shait\kernel rpm\dummy\ksocket\berkeley.c

; 591  :   *addrlen = sizeof(SOCKADDR);

  00150	41 c7 06 10 00
	00 00		 mov	 DWORD PTR [r14], 16

; 592  : 
; 593  :   if (NT_SUCCESS(Status))

  00157	85 ff		 test	 edi, edi
  00159	78 83		 js	 SHORT $LN2@accept

; 594  :   {
; 595  :     int newsockfd = TO_SOCKETFD(KsIndex++);

  0015b	8b 0d 00 00 00
	00		 mov	 ecx, DWORD PTR KsIndex
  00161	8b c1		 mov	 eax, ecx
  00163	83 e0 7f	 and	 eax, 127		; 0000007fH
  00166	ff c1		 inc	 ecx
  00168	89 0d 00 00 00
	00		 mov	 DWORD PTR KsIndex, ecx

; 596  : 
; 597  :     KsArray[FROM_SOCKETFD(newsockfd)] = NewSocket;

  0016e	49 89 1c c4	 mov	 QWORD PTR [r12+rax*8], rbx
  00172	ff c0		 inc	 eax

; 598  : 
; 599  :     return newsockfd;

  00174	e9 6a ff ff ff	 jmp	 $LN1@accept
accept	ENDP
_TEXT	ENDS
; Function compile flags: /Ogtp
; File c:\users\aapo\desktop\fortnite_shait\kernel rpm\dummy\ksocket\berkeley.c
; File c:\users\aapo\desktop\fortnite_shait\kernel rpm\dummy\ksocket\ksocket.c
; File c:\users\aapo\desktop\fortnite_shait\kernel rpm\dummy\ksocket\berkeley.c
; File c:\users\aapo\desktop\fortnite_shait\kernel rpm\dummy\ksocket\ksocket.c
; File c:\users\aapo\desktop\fortnite_shait\kernel rpm\dummy\ksocket\berkeley.c
; File c:\users\aapo\desktop\fortnite_shait\kernel rpm\dummy\ksocket\ksocket.c
; File c:\users\aapo\desktop\fortnite_shait\kernel rpm\dummy\ksocket\berkeley.c
;	COMDAT send
_TEXT	SEGMENT
sockfd$ = 64
buf$ = 72
len$dead$ = 80
flags$dead$ = 88
Length$ = 88
send	PROC						; COMDAT

; 606  : {

$LN6:
  00000	44 89 4c 24 20	 mov	 DWORD PTR [rsp+32], r9d
  00005	48 83 ec 38	 sub	 rsp, 56			; 00000038H

; 608  :   PKSOCKET Socket = KsArray[FROM_SOCKETFD(sockfd)];

  00009	48 63 c1	 movsxd	 rax, ecx
; File c:\users\aapo\desktop\fortnite_shait\kernel rpm\dummy\ksocket\ksocket.c

; 842  :   return KsSendRecv(Socket, Buffer, Length, Flags, TRUE);

  0000c	4c 8d 44 24 58	 lea	 r8, QWORD PTR Length$[rsp]
; File c:\users\aapo\desktop\fortnite_shait\kernel rpm\dummy\ksocket\berkeley.c

; 608  :   PKSOCKET Socket = KsArray[FROM_SOCKETFD(sockfd)];

  00011	48 8d 0d 00 00
	00 00		 lea	 rcx, OFFSET FLAT:KsArray

; 609  : 
; 610  :   ULONG Length = (ULONG)len;

  00018	c7 44 24 58 30
	00 00 00	 mov	 DWORD PTR Length$[rsp], 48 ; 00000030H
; File c:\users\aapo\desktop\fortnite_shait\kernel rpm\dummy\ksocket\ksocket.c

; 842  :   return KsSendRecv(Socket, Buffer, Length, Flags, TRUE);

  00020	c6 44 24 20 01	 mov	 BYTE PTR [rsp+32], 1
; File c:\users\aapo\desktop\fortnite_shait\kernel rpm\dummy\ksocket\berkeley.c

; 608  :   PKSOCKET Socket = KsArray[FROM_SOCKETFD(sockfd)];

  00025	48 8b 4c c1 f8	 mov	 rcx, QWORD PTR [rcx+rax*8-8]
; File c:\users\aapo\desktop\fortnite_shait\kernel rpm\dummy\ksocket\ksocket.c

; 842  :   return KsSendRecv(Socket, Buffer, Length, Flags, TRUE);

  0002a	e8 00 00 00 00	 call	 KsSendRecv
; File c:\users\aapo\desktop\fortnite_shait\kernel rpm\dummy\ksocket\berkeley.c

; 613  :   return NT_SUCCESS(Status)

  0002f	85 c0		 test	 eax, eax
  00031	b9 ff ff ff ff	 mov	 ecx, -1
  00036	0f 49 4c 24 58	 cmovns	 ecx, DWORD PTR Length$[rsp]
  0003b	8b c1		 mov	 eax, ecx

; 614  :     ? (int)Length
; 615  :     : -1;
; 616  : }

  0003d	48 83 c4 38	 add	 rsp, 56			; 00000038H
  00041	c3		 ret	 0
send	ENDP
_TEXT	ENDS
; Function compile flags: /Ogtp
; File c:\users\aapo\desktop\fortnite_shait\kernel rpm\dummy\ksocket\berkeley.c
; File c:\users\aapo\desktop\fortnite_shait\kernel rpm\dummy\ksocket\ksocket.c
; File c:\users\aapo\desktop\fortnite_shait\kernel rpm\dummy\ksocket\berkeley.c
; File c:\users\aapo\desktop\fortnite_shait\kernel rpm\dummy\ksocket\ksocket.c
; File c:\users\aapo\desktop\fortnite_shait\kernel rpm\dummy\ksocket\berkeley.c
; File c:\users\aapo\desktop\fortnite_shait\kernel rpm\dummy\ksocket\ksocket.c
; File c:\users\aapo\desktop\fortnite_shait\kernel rpm\dummy\ksocket\berkeley.c
;	COMDAT recv
_TEXT	SEGMENT
sockfd$ = 64
buf$ = 72
len$dead$ = 80
flags$dead$ = 88
Length$ = 88
recv	PROC						; COMDAT

; 634  : {

$LN6:
  00000	44 89 4c 24 20	 mov	 DWORD PTR [rsp+32], r9d
  00005	48 83 ec 38	 sub	 rsp, 56			; 00000038H

; 636  :   PKSOCKET Socket = KsArray[FROM_SOCKETFD(sockfd)];

  00009	48 63 c1	 movsxd	 rax, ecx
; File c:\users\aapo\desktop\fortnite_shait\kernel rpm\dummy\ksocket\ksocket.c

; 854  :   return KsSendRecv(Socket, Buffer, Length, Flags, FALSE);

  0000c	4c 8d 44 24 58	 lea	 r8, QWORD PTR Length$[rsp]
; File c:\users\aapo\desktop\fortnite_shait\kernel rpm\dummy\ksocket\berkeley.c

; 636  :   PKSOCKET Socket = KsArray[FROM_SOCKETFD(sockfd)];

  00011	48 8d 0d 00 00
	00 00		 lea	 rcx, OFFSET FLAT:KsArray

; 637  : 
; 638  :   ULONG Length = (ULONG)len;

  00018	c7 44 24 58 30
	00 00 00	 mov	 DWORD PTR Length$[rsp], 48 ; 00000030H
; File c:\users\aapo\desktop\fortnite_shait\kernel rpm\dummy\ksocket\ksocket.c

; 854  :   return KsSendRecv(Socket, Buffer, Length, Flags, FALSE);

  00020	c6 44 24 20 00	 mov	 BYTE PTR [rsp+32], 0
; File c:\users\aapo\desktop\fortnite_shait\kernel rpm\dummy\ksocket\berkeley.c

; 636  :   PKSOCKET Socket = KsArray[FROM_SOCKETFD(sockfd)];

  00025	48 8b 4c c1 f8	 mov	 rcx, QWORD PTR [rcx+rax*8-8]
; File c:\users\aapo\desktop\fortnite_shait\kernel rpm\dummy\ksocket\ksocket.c

; 854  :   return KsSendRecv(Socket, Buffer, Length, Flags, FALSE);

  0002a	e8 00 00 00 00	 call	 KsSendRecv
; File c:\users\aapo\desktop\fortnite_shait\kernel rpm\dummy\ksocket\berkeley.c

; 641  :   return NT_SUCCESS(Status)

  0002f	85 c0		 test	 eax, eax
  00031	b9 ff ff ff ff	 mov	 ecx, -1
  00036	0f 49 4c 24 58	 cmovns	 ecx, DWORD PTR Length$[rsp]
  0003b	8b c1		 mov	 eax, ecx

; 642  :     ? (int)Length
; 643  :     : -1;
; 644  : }

  0003d	48 83 c4 38	 add	 rsp, 56			; 00000038H
  00041	c3		 ret	 0
recv	ENDP
_TEXT	ENDS
; Function compile flags: /Ogtp
; File c:\users\aapo\desktop\fortnite_shait\kernel rpm\dummy\ksocket\berkeley.c
; File c:\users\aapo\desktop\fortnite_shait\kernel rpm\dummy\ksocket\ksocket.c
; File c:\program files (x86)\windows kits\10\include\10.0.17763.0\km\wdm.h
; File c:\users\aapo\desktop\fortnite_shait\kernel rpm\dummy\ksocket\ksocket.c
; File c:\users\aapo\desktop\fortnite_shait\kernel rpm\dummy\ksocket\berkeley.c
;	COMDAT closesocket
_TEXT	SEGMENT
sockfd$ = 64
closesocket PROC					; COMDAT

; 663  : {

$LN20:
  00000	48 89 5c 24 08	 mov	 QWORD PTR [rsp+8], rbx
  00005	48 89 74 24 10	 mov	 QWORD PTR [rsp+16], rsi
  0000a	48 89 7c 24 18	 mov	 QWORD PTR [rsp+24], rdi
  0000f	41 56		 push	 r14
  00011	48 83 ec 30	 sub	 rsp, 48			; 00000030H

; 664  :   NTSTATUS Status;
; 665  :   PKSOCKET Socket = KsArray[FROM_SOCKETFD(sockfd)];

  00015	48 63 c1	 movsxd	 rax, ecx
  00018	48 8d 0d 00 00
	00 00		 lea	 rcx, OFFSET FLAT:KsArray
  0001f	48 8b 7c c1 f8	 mov	 rdi, QWORD PTR [rcx+rax*8-8]
  00024	4c 8d 34 c1	 lea	 r14, QWORD PTR [rcx+rax*8]
; File c:\users\aapo\desktop\fortnite_shait\kernel rpm\dummy\ksocket\ksocket.c

; 466  :   KspAsyncContextReset(&Socket->AsyncContext);

  00028	48 8d 77 10	 lea	 rsi, QWORD PTR [rdi+16]

; 173  :   KeResetEvent(&AsyncContext->CompletionEvent);

  0002c	48 8b ce	 mov	 rcx, rsi
  0002f	ff 15 00 00 00
	00		 call	 QWORD PTR __imp_KeResetEvent

; 174  : 
; 175  :   //
; 176  :   // Reuse the IRP.
; 177  :   //
; 178  : 
; 179  :   IoReuseIrp(AsyncContext->Irp, STATUS_UNSUCCESSFUL);

  00035	48 8b 4e 18	 mov	 rcx, QWORD PTR [rsi+24]
  00039	ba 01 00 00 c0	 mov	 edx, -1073741823	; ffffffffc0000001H
  0003e	ff 15 00 00 00
	00		 call	 QWORD PTR __imp_IoReuseIrp
; File c:\program files (x86)\windows kits\10\include\10.0.17763.0\km\wdm.h

; 31468:     return ((Irp)->Tail.Overlay.CurrentStackLocation - 1 );

  00044	48 8b 46 18	 mov	 rax, QWORD PTR [rsi+24]
  00048	48 8b 88 b8 00
	00 00		 mov	 rcx, QWORD PTR [rax+184]

; 31851:     irpSp->CompletionRoutine = CompletionRoutine;

  0004f	48 8d 05 00 00
	00 00		 lea	 rax, OFFSET FLAT:KspAsyncContextCompletionRoutine
  00056	48 89 41 f0	 mov	 QWORD PTR [rcx-16], rax

; 31852:     irpSp->Context = Context;

  0005a	48 89 71 f8	 mov	 QWORD PTR [rcx-8], rsi

; 31853:     irpSp->Control = 0;
; 31854: 
; 31855:     if (InvokeOnSuccess) {
; 31856:         irpSp->Control = SL_INVOKE_ON_SUCCESS;
; 31857:     }
; 31858: 
; 31859:     if (InvokeOnError) {
; 31860:         irpSp->Control |= SL_INVOKE_ON_ERROR;
; 31861:     }
; 31862: 
; 31863:     if (InvokeOnCancel) {
; 31864:         irpSp->Control |= SL_INVOKE_ON_CANCEL;

  0005e	c6 41 bb e0	 mov	 BYTE PTR [rcx-69], 224	; 000000e0H
; File c:\users\aapo\desktop\fortnite_shait\kernel rpm\dummy\ksocket\ksocket.c

; 472  :   Status = Socket->WskConnectionDispatch->WskCloseSocket(

  00062	48 8b 47 08	 mov	 rax, QWORD PTR [rdi+8]
  00066	48 8b 57 28	 mov	 rdx, QWORD PTR [rdi+40]
  0006a	48 8b 0f	 mov	 rcx, QWORD PTR [rdi]
  0006d	ff 50 08	 call	 QWORD PTR [rax+8]
  00070	8b d8		 mov	 ebx, eax

; 213  :   if (*Status == STATUS_PENDING)

  00072	3d 03 01 00 00	 cmp	 eax, 259		; 00000103H
  00077	75 21		 jne	 SHORT $LN15@closesocke

; 214  :   {
; 215  :     KeWaitForSingleObject(

  00079	45 33 c9	 xor	 r9d, r9d
  0007c	48 c7 44 24 20
	00 00 00 00	 mov	 QWORD PTR [rsp+32], 0
  00085	45 33 c0	 xor	 r8d, r8d
  00088	33 d2		 xor	 edx, edx
  0008a	48 8b ce	 mov	 rcx, rsi
  0008d	ff 15 00 00 00
	00		 call	 QWORD PTR __imp_KeWaitForSingleObject

; 216  :       &AsyncContext->CompletionEvent,
; 217  :       Executive,
; 218  :       KernelMode,
; 219  :       FALSE,
; 220  :       NULL
; 221  :       );
; 222  : 
; 223  :     *Status = AsyncContext->Irp->IoStatus.Status;

  00093	48 8b 46 18	 mov	 rax, QWORD PTR [rsi+24]
  00097	8b 58 30	 mov	 ebx, DWORD PTR [rax+48]
$LN15@closesocke:

; 141  :   IoFreeIrp(AsyncContext->Irp);

  0009a	48 8b 4f 28	 mov	 rcx, QWORD PTR [rdi+40]
  0009e	ff 15 00 00 00
	00		 call	 QWORD PTR __imp_IoFreeIrp

; 489  :   ExFreePoolWithTag(Socket, MEMORY_TAG);

  000a4	ba 61 34 66 64	 mov	 edx, 1684419681		; 64663461H
  000a9	48 8b cf	 mov	 rcx, rdi
  000ac	ff 15 00 00 00
	00		 call	 QWORD PTR __imp_ExFreePoolWithTag
; File c:\users\aapo\desktop\fortnite_shait\kernel rpm\dummy\ksocket\berkeley.c

; 674  : }

  000b2	48 8b 74 24 48	 mov	 rsi, QWORD PTR [rsp+72]
  000b7	48 8b 7c 24 50	 mov	 rdi, QWORD PTR [rsp+80]
  000bc	c1 fb 1f	 sar	 ebx, 31
  000bf	8b c3		 mov	 eax, ebx
  000c1	49 c7 46 f8 00
	00 00 00	 mov	 QWORD PTR [r14-8], 0
  000c9	48 8b 5c 24 40	 mov	 rbx, QWORD PTR [rsp+64]
  000ce	48 83 c4 30	 add	 rsp, 48			; 00000030H
  000d2	41 5e		 pop	 r14
  000d4	c3		 ret	 0
closesocket ENDP
_TEXT	ENDS
END
